!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},t=(new e.Error).stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="faae096c-2c1c-4b12-af67-e1fdbdbaa341",e._sentryDebugIdIdentifier="sentry-dbid-faae096c-2c1c-4b12-af67-e1fdbdbaa341")}catch(e){}}();"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[50887],{30693:(e,t,a)=>{a.d(t,{F:()=>o});var s=a(79342),i=a(11750),n=a(88382),r=a(65146),l=a(75500);function o(){let e=(0,l.h)();return(0,n.useMemo)(()=>{var t,a;let s=Array.isArray(null==(a=e.EDIT_IMAGE_PRESETS)||null==(t=a.value)?void 0:t.presets)?e.EDIT_IMAGE_PRESETS.value.presets:[];return{editImagePresets:d.map(e=>({...e,label:e.label,presets:e.presets.map(e=>{var t,a;return{...e,prompt:null!=(a=null==(t=s.find(t=>t.presetId===e.presetId))?void 0:t.prompt)?a:""}})})).filter(e=>e.presets.some(e=>e.prompt)).map(e=>({...e,presets:e.presets.filter(e=>e.prompt)}))}},[e])}let d=[{category:"creative",icon:i.v9l,label:(0,s.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.categories.creative",defaults:"Creative"}),presets:[{presetId:"water-color",icon:i.RSl,label:(0,s.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.water-color",defaults:"Watercolor"}),previewUrl:"/image-editing-preset-previews/water-color.jpg"},{presetId:"15th-century",icon:i.lqP,label:(0,s.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.15th-century",defaults:"15th Century"}),previewUrl:"/image-editing-preset-previews/15th-century.jpg"},{presetId:"graffiti",icon:i.OKP,label:(0,s.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.graffiti",defaults:"Graffiti"}),previewUrl:"/image-editing-preset-previews/graffiti.jpg"},{presetId:"renaissance-painting",icon:i.esB,label:(0,s.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.renaissance-painting",defaults:"Renaissance Painting"}),previewUrl:"/image-editing-preset-previews/renaissance-painting.jpg"},{presetId:"symbolist-painting",icon:i.kU3,label:(0,s.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.symbolist-painting",defaults:"Symbolist Painting"}),previewUrl:"/image-editing-preset-previews/symbolist-painting.jpg"},{presetId:"expressionist-painting",icon:i.vMd,label:(0,s.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.expressionist-painting",defaults:"Expressionist Painting"}),previewUrl:"/image-editing-preset-previews/expressionist-painting.jpg"},{presetId:"cubist-painting",icon:i.M6A,label:(0,s.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.cubist-painting",defaults:"Cubist Painting"}),previewUrl:"/image-editing-preset-previews/cubist-painting.jpg"},{presetId:"ukiyo-e-painting",icon:i.GeJ,label:(0,s.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.ukiyo-e-painting",defaults:"Ukiyo-e Painting"}),previewUrl:"/image-editing-preset-previews/ukiyo-e-painting.jpg"},{presetId:"bright-anime",icon:i.pnY,label:(0,s.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.bright-anime",defaults:"Bright Anime"}),previewUrl:"/image-editing-preset-previews/bright-anime.jpg"},{presetId:"dark-anime",icon:i.AUI,label:(0,s.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.dark-anime",defaults:"Dark Anime"}),previewUrl:"/image-editing-preset-previews/dark-anime.jpg"},{presetId:"cyberpunk",icon:i.Qxc,label:(0,s.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.cyberpunk",defaults:"Cyberpunk"}),previewUrl:"/image-editing-preset-previews/cyberpunk.jpg"},{presetId:"retro-game",icon:i.Wud,label:(0,s.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.retro-game",defaults:"Retro Game"}),previewUrl:"/image-editing-preset-previews/retro-game.jpg"}]},{category:"background",icon:i.dM2,label:(0,s.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.categories.background",defaults:"Background"}),presets:[{presetId:"paris",icon:i.t6i,label:(0,s.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.paris",defaults:"Paris"}),previewUrl:"/image-editing-preset-previews/paris.jpg"},{presetId:"london",icon:i.t6i,label:(0,s.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.london",defaults:"London"}),previewUrl:"/image-editing-preset-previews/london.jpg"},{presetId:"tokyo",icon:i.t6i,label:(0,s.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.tokyo",defaults:"Tokyo"}),previewUrl:"/image-editing-preset-previews/tokyo.jpg"},{presetId:"mars",icon:i.XQK,label:(0,s.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.mars",defaults:"Mars"}),previewUrl:"/image-editing-preset-previews/mars.jpg"},{presetId:"tropical-paradise",icon:i.L71,label:(0,s.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.tropical-paradise",defaults:"Tropical Paradise"}),previewUrl:"/image-editing-preset-previews/tropical-paradise.jpg"},{presetId:"cosmic-void",icon:i.sUz,label:(0,s.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.cosmic-void",defaults:"Cosmic Void"}),previewUrl:"/image-editing-preset-previews/cosmic-void.jpg"},{presetId:"urban-rooftop",icon:i.t6i,label:(0,s.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.urban-rooftop",defaults:"Urban Rooftop"}),previewUrl:"/image-editing-preset-previews/urban-rooftop.jpg"},{presetId:"enchanted-cave",icon:i.gDK,label:(0,s.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.enchanted-cave",defaults:"Enchanted Cave"}),previewUrl:"/image-editing-preset-previews/enchanted-cave.jpg"},{presetId:"misty-forest",icon:i.YUH,label:(0,s.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.misty-forest",defaults:"Misty Forest"}),previewUrl:"/image-editing-preset-previews/misty-forest.jpg"},{presetId:"retro-arcade",icon:i.ZNA,label:(0,s.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.retro-arcade",defaults:"Retro Arcade"}),previewUrl:"/image-editing-preset-previews/retro-arcade.jpg"},{presetId:"space-station",icon:i.f36,label:(0,s.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.space-station",defaults:"Space Station"}),previewUrl:"/image-editing-preset-previews/space-station.jpg"},{presetId:"desert-oasis",icon:i.L71,label:(0,s.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.desert-oasis",defaults:"Desert Oasis"}),previewUrl:"/image-editing-preset-previews/desert-oasis.jpg"},{presetId:"volcano-lair",icon:i.Q5j,label:(0,s.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.volcano-lair",defaults:"Volcano Lair"}),previewUrl:"/image-editing-preset-previews/volcano-lair.jpg"},{presetId:"post-apocalypse",icon:i.A1H,label:(0,s.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.post-apocalypse",defaults:"Post-Apocalypse"}),previewUrl:"/image-editing-preset-previews/post-apocalypse.jpg"}]},{category:"subject",icon:i.BDI,label:(0,s.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.categories.subject",defaults:"Subject"}),presets:[{presetId:"stylish-hat",icon:i.fbd,label:(0,s.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.stylish-hat",defaults:"Stylish Hat"}),previewUrl:"/image-editing-preset-previews/stylish-hat.jpg"},{presetId:"mustache",icon:i.Hx3,label:(0,s.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.mustache",defaults:"Mustache"}),previewUrl:"/image-editing-preset-previews/mustache.jpg"},{presetId:"superhero-costume",icon:i.KqI,label:(0,s.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.superhero-costume",defaults:"Superhero Costume"}),previewUrl:"/image-editing-preset-previews/superhero-costume.jpg"},{presetId:"golden-glow",icon:i.S7m,label:(0,s.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.golden-glow",defaults:"Golden Glow"}),previewUrl:"/image-editing-preset-previews/golden-glow.jpg"},{presetId:"mecha-warrior",icon:i.cC5,label:(0,s.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.mecha-warrior",defaults:"Mecha Warrior"}),previewUrl:"/image-editing-preset-previews/mecha-warrior.jpg"},{presetId:"sunglasses-jacket",icon:i.ljW,label:(0,s.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.sunglasses-jacket",defaults:"Sunglasses & Jacket"}),previewUrl:"/image-editing-preset-previews/sunglasses-jacket.jpg"},{presetId:"medieval-armor",icon:i.ekZ,label:(0,s.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.medieval-armor",defaults:"Medieval Armor"}),previewUrl:"/image-editing-preset-previews/medieval-armor.jpg"},{presetId:"time-traveler",icon:i.zD7,label:(0,s.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.time-traveler",defaults:"Time Traveler"}),previewUrl:"/image-editing-preset-previews/time-traveler.jpg"},{presetId:"hologram-effect",icon:i.srL,label:(0,s.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.hologram-effect",defaults:"Hologram Effect"}),previewUrl:"/image-editing-preset-previews/hologram-effect.jpg"},{presetId:"dragon-rider",icon:i.Q5j,label:(0,s.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.dragon-rider",defaults:"Dragon Rider"}),previewUrl:"/image-editing-preset-previews/dragon-rider.jpg"},{presetId:"remove-people",icon:i.Kr6,label:(0,s.jsx)(r.x6,{ns:"base",i18nKey:"edit-image-presets.presets.remove-people",defaults:"Remove People"}),previewUrl:"/image-editing-preset-previews/remove-people.jpg"}]}]},38362:(e,t,a)=>{a.d(t,{g:()=>h});var s=a(79342),i=a(81884),n=a(52553),r=a(23232),l=a(98100),o=a(92437),d=a(70888),c=a(11750),u=a(84969),m=a(23054),p=a(74995),g=a(65146),x=a(38614);function h(e){let{conversationId:t,containerRef:a,user:h,imageAttachmentsOnly:v=!1}=e,{t:f}=(0,g.Bd)("chat"),b=function(e,t,a){let s=(0,x.aP)(p.A("activeModelId")),{modelById:c}=(0,l.GB)(),u=null==c?void 0:c[s],{isAttachDisabled:m}=(0,l.QG)(u),{attachFiles:g}=(0,n.S)(),h=(0,r._)(),{user:v}=(0,i.useSession)(),f=(0,d.x)(p.A("listByConversationId"))[e||"no_conversation_id"]||[];return"hover"===(0,o.t)({onDrop:e=>{v&&(g(e),e.forEach(e=>{h("upload_file",e.name,{location:"file-drop",mimeType:e.type})}))},canDrop:e=>{var t;return!m&&!!e.files.length&&(!a||!(e.files.length>1)&&!!(null==(t=e.files[0])?void 0:t.type.startsWith("image/")))&&(!f.length||!f.find(t=>{var a;return t.file.name===(null==(a=e.files[0])?void 0:a.name)}))},ref:t},[f,v,m,g])}(t,a,v),y=(0,x.aP)(p.A("activeModelId")),{modelById:j}=(0,l.GB)(),w=null==j?void 0:j[y],{isAttachDisabled:I,isThinkSelected:N,isDeepsearchSelected:k}=(0,l.QG)(w);return(0,s.jsx)(u.N,{children:b&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(m.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"absolute inset-0 bg-overlay z-50"},"drop-backdrop"),(0,s.jsx)(m.P.div,{initial:{opacity:0,translateY:20},animate:{opacity:1,translateY:0},exit:{opacity:0,translateY:20},className:"absolute inset-0 z-50 flex items-center justify-center p-6 pointer-events-none",children:h?I?(0,s.jsxs)("div",{className:"rounded-2xl w-full max-w-xl bg-background flex flex-col items-center py-12 border-[1px] border-dashed border-input-border",children:[(0,s.jsx)("div",{children:(0,s.jsx)(c.lW3,{size:32,className:"text-red-400"})}),(0,s.jsx)("h2",{className:"mt-4 text-lg font-medium text-primary",children:f("Attachments are disabled","Attachments are disabled")}),(0,s.jsxs)("p",{className:"text-secondary",children:[f("Attachments are disabled for","Attachments are disabled for")," ",(0,s.jsx)("span",{className:"font-semibold",children:N?"Think":k?"DeepSearch":void 0})]})]}):(0,s.jsxs)("div",{className:"rounded-2xl w-full max-w-xl bg-background flex flex-col items-center py-12 border-[1px] border-dashed border-input-border",children:[(0,s.jsx)("div",{children:(0,s.jsx)(c.XGR,{size:32,className:"text-secondary"})}),(0,s.jsx)("h2",{className:"mt-4 text-lg font-medium text-primary",children:f("Drop your files here","Drop your files here")}),(0,s.jsx)("p",{className:"text-secondary",children:f("Drop your files here to add them to your conversation","Drop your files here to add them to your conversation")})]}):(0,s.jsxs)("div",{className:"flex flex-col items-center w-full max-w-xl py-12 border-4 border-red-400 border-dashed rounded-2xl bg-background",children:[(0,s.jsx)("div",{children:(0,s.jsx)(c.XGR,{size:32,className:"text-secondary"})}),(0,s.jsx)("h2",{className:"mt-4 mb-2 text-lg font-medium text-red-400",children:f("Sign in to attach files!","Sign in to attach files!")}),(0,s.jsx)("p",{className:"text-secondary",children:f("You must be signed in to attach files to your conversation","You must be signed in to attach files to your conversation")})]})},"drop-modal")]})})}},40016:(e,t,a)=>{a.d(t,{q:()=>p});var s=a(79342),i=a(38614),n=a(11750),r=a(61312),l=a(97960),o=a(23054),d=a(74995),c=a(88382),u=a(65146),m=a(63174);let p=e=>{let{className:t,hasImage:a,inputValue:p,isStreaming:g,onInputValueChange:x,onSend:h,onAbort:v}=e,{t:f}=(0,u.Bd)("base"),b=(0,i.aP)(d.A("lastMessageId")),y=(0,i.aP)(d.A("streamedMessageId")),j=(0,l.A3)(d.A("byId")),w=(0,c.useRef)(null),I=(0,c.useRef)(null),[N,k]=(0,c.useState)(!1),S=(0,c.useMemo)(()=>g||!a,[g,a]),C=(0,c.useMemo)(()=>!N&&!g&&a&&!!p.trim(),[N,a,p,g]),E=(0,c.useCallback)(async e=>{var t;e.preventDefault(),!S&&p.trim()&&(k(!0),await (null==(t=h(p))?void 0:t.finally(()=>{var e;null==(e=I.current)||e.focus(),k(!1)})))},[h,S,p]),_=(0,c.useMemo)(()=>{let e=y?j[y]:void 0;if((null==e?void 0:e.parentResponseId)===b)return e},[y,j,b]),M=(0,c.useMemo)(()=>{if(g)return(null==_?void 0:_.state)||"closed"},[g,_]),P=(0,c.useCallback)(e=>{if(e.stopPropagation(),"Enter"===e.key&&!e.metaKey&&!e.ctrlKey&&!e.shiftKey&&!e.nativeEvent.isComposing){var t;e.preventDefault(),null==(t=w.current)||t.dispatchEvent(new Event("submit",{cancelable:!0,bubbles:!0}))}},[]);return(0,s.jsxs)("form",{className:(0,r.cn)("w-full rounded-[32px] p-3 bg-input-background shadow shadow-input-border/10 flex gap-2 pl-5 items-end ring-1 ring-input-border ring-inset",t),onSubmit:E,ref:w,children:[(0,s.jsx)(m.A,{ref:I,className:(0,r.cn)("w-full @[480px]/input:px-3 bg-transparent focus:outline-none text-primary align-bottom resize-none pb-1.5",g&&"animate-pulse"),onChange:e=>x(e.target.value),value:p,placeholder:a?g?f("Editing image","Editing image"):f("Describe your edits","Describe your edits"):f("Upload an image to begin","Upload an image to begin"),minRows:1,onKeyDown:P,autoFocus:!0,disabled:S,name:"query",maxRows:5}),(0,s.jsx)("div",{className:(0,r.cn)("ml-auto flex flex-row items-end gap-1"),children:g&&("streaming"===M||"reconnecting"===M)?(0,s.jsx)(o.P.button,{whileTap:{scale:.95},initial:{scale:.95,opacity:1},animate:{scale:1,opacity:1},exit:{scale:.8,opacity:.5,transition:{duration:.2}},className:(0,r.cn)("group flex flex-col justify-center rounded-full focus:outline-none focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring"),onClick:e=>{e.preventDefault(),v().catch(console.error)},children:(0,s.jsx)("div",{className:(0,r.cn)("h-9","aspect-square flex flex-col items-center justify-center rounded-full","rounded-full ring-1 ring-inset","bg-primary text-background ring-button-outline-border"),children:(0,s.jsx)(n.M6A,{size:20})})}):(0,s.jsx)(o.P.button,{initial:{opacity:.5},animate:{opacity:1,transition:{duration:.1}},whileHover:a?{scale:1.1}:void 0,whileTap:a?{scale:.95}:void 0,className:(0,r.cn)("group flex flex-col justify-center rounded-full focus:outline-none focus-visible:outline-none focus-visible:ring-1 focus-visible:ring-ring"),type:"submit","aria-label":f("Submit","Submit"),disabled:!C,children:(0,s.jsx)("div",{className:(0,r.cn)("h-9 relative","aspect-square flex flex-col items-center justify-center","rounded-full ring-1 ring-inset duration-100","before:absolute before:inset-0 before:rounded-full before:bg-primary before:ring-0 before:transition-all duration-500",C?"bg-primary text-background ring-transparent before: before:[clip-path:circle(50%_at_50%_50%)]":"bg-button-secondary text-secondary before:[clip-path:circle(0%_at_50%_50%)] ring-0"),children:(0,s.jsx)(n.Kpk,{size:20,className:"relative"})})})})]})}},50887:(e,t,a)=>{a.d(t,{A:()=>t8});var s=a(79342),i=a(13010),n=a(44428),r=a(82591),l=a(10953),o=a(38614),d=a(15041),c=a(39489),u=a(52244),m=a(11750),p=a(56691),g=a(30693),x=a(4295),h=a(12220),v=a(17703),f=a(84969),b=a(23054),y=a(88382),j=a(65146),w=a(43086);let I=e=>{let{hasImage:t,prompt:a,onParentPeek:i,focusedImageUrl:n,parentImageUrl:r,isStreaming:l,onRegenerate:d,onClose:c}=e,{t:I}=(0,j.Bd)("base"),[N,k]=(0,y.useState)(!1),[S,C]=(0,y.useState)(void 0),[E,_]=(0,y.useState)(!1),M=(0,x.c)(),P=(0,o.aP)(e=>e.conversationId),A=(0,o.aP)(e=>e.lastMessageId),{editImagePresets:T}=(0,g.F)(),R=(0,y.useMemo)(()=>{if(!S)return;let e=T.flatMap(e=>e.presets).find(e=>e.prompt===S);return e?(0,s.jsxs)(s.Fragment,{children:[e.icon&&y.createElement(e.icon,{size:20,className:"text-secondary flex-shrink-0"}),(0,s.jsx)("h1",{className:"text-lg font-semibold truncate",children:e.label})]}):(0,s.jsx)("h1",{className:"text-lg font-semibold truncate",children:S})},[S,T]),D=(0,y.useCallback)(()=>{!E&&n&&(_(!0),(0,h.G)(n,null==n?void 0:n.split("/").pop()).catch((0,v.HX)("image-editor:handleDownload")).finally(()=>_(!1)))},[n,E]);return(0,y.useEffect)(()=>{a&&S!==a&&C(a)},[a,S]),(0,y.useEffect)(()=>{r&&!N&&k(!0)},[r,N]),(0,s.jsx)("header",{className:"flex justify-between w-full items-center min-h-10 gap-3  relative z-30 flex-shrink-0",children:(0,s.jsxs)(f.N,{mode:"popLayout",children:[S&&(0,s.jsx)(b.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{ease:"easeInOut"},className:"flex items-center gap-2 w-full overflow-hidden min-w-0",children:R},S),(0,s.jsxs)("div",{className:"flex gap-2 ms-auto shrink-0",children:[(0,s.jsxs)(s.Fragment,{children:[N&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(b.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{ease:"easeInOut"},children:(0,s.jsx)(p.gx,{size:"iconMd",variant:"ghost",rounded:!0,"aria-label":I("Compare","Compare"),tooltipContent:I("Compare","Compare"),tooltipContentProps:{side:"bottom"},onMouseDown:()=>i(!0),onMouseUp:()=>i(!1),onMouseLeave:()=>i(!1),onTouchStart:e=>{e.preventDefault(),e.stopPropagation(),i(!0)},onTouchEnd:e=>{e.preventDefault(),e.stopPropagation(),i(!1)},onContextMenu:e=>{e.preventDefault(),e.stopPropagation()},onContextMenuCapture:e=>{e.preventDefault(),e.stopPropagation()},asChild:!0,disabled:l||!r,children:(0,s.jsx)(b.P.button,{whileTap:!l&&r?{scale:.9}:void 0,children:(0,s.jsx)(m.Uye,{className:"size-5"})})})},"compare"),(0,s.jsx)(b.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{ease:"easeInOut"},children:(0,s.jsx)(p.gx,{size:"iconMd",variant:"ghost",rounded:!0,"aria-label":I("Regenerate","Regenerate"),tooltipContent:I("Regenerate","Regenerate"),tooltipContentProps:{side:"bottom"},asChild:!0,disabled:l||!r,onClick:d,children:(0,s.jsx)(b.P.button,{whileTap:!l&&r?{scale:.9}:void 0,children:(0,s.jsx)(m.V$7,{className:"size-5"})})})},"regenerate")]}),t&&(0,s.jsx)(b.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{ease:"easeInOut"},children:(0,s.jsx)(p.gx,{variant:"ghost",size:"iconMd",rounded:!0,"aria-label":I("Download Image","Download Image"),tooltipContent:I("Download Image","Download Image"),tooltipContentProps:{side:"bottom"},disabled:l||!n||E,onClick:D,children:E?(0,s.jsx)(w.y,{size:"xs"}):(0,s.jsx)(m.s3U,{className:"size-5"})})},"download"),P&&A&&(0,s.jsx)(b.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{ease:"easeInOut"},children:(0,s.jsx)(u.w,{variant:"ghost",size:"iconMd",rounded:!0,conversationId:P,responseId:A,iconProps:{size:20}})},"share")]}),M?(0,s.jsx)(p.$n,{"aria-label":I("Close Image Editor","Close Image Editor"),variant:"filled",size:"iconMd",rounded:!0,onClick:c,children:(0,s.jsx)(m.uv5,{size:20})}):(0,s.jsx)(p.gx,{"aria-label":I("Close Image Editor","Close Image Editor"),tooltipContent:I("Close Image Editor","Close Image Editor"),tooltipContentProps:{side:"bottom"},variant:"filled",size:"md",rounded:!0,onClick:c,children:I("Close","Close")})]})]})})};var N=a(28951),k=a(61312);let S=e=>{let{images:t,focusedOption:a,isStreaming:i,onSelect:n}=e;return(0,s.jsx)(b.P.aside,{className:"lg:fixed top-0 inset-0 lg:top-0 lg:right-0 lg:left-auto flex lg:flex-col items-center justify-center lg:h-full gap-4 pb-3 lg:p-6 pointer-events-none z-30",variants:{visible:{opacity:1},hidden:{opacity:0}},initial:"hidden",animate:"visible",exit:"hidden",children:(0,s.jsx)(f.N,{mode:"popLayout",children:t.map((e,t)=>(0,s.jsx)(b.P.button,{className:(0,k.cn)("size-16 sm:size-20 relative rounded-xl border bg-background p-1 pointer-events-auto",{"ring-primary ring-2":t===a}),onClick:()=>n(t),whileTap:t!==a?{scale:.95}:{},variants:{visible:{opacity:1},hidden:{opacity:0}},initial:"hidden",animate:"visible",exit:"hidden",children:(0,s.jsx)("div",{className:"relative h-full w-full overflow-hidden rounded-lg",children:(0,s.jsx)("figure",{className:"absolute -translate-x-1/2 left-1/2 h-full aspect-[4/3]",children:(0,s.jsx)(N.L,{isModerated:e.isModerated,status:i?"streaming":"finished",iconSize:24,intermediateResults:i?e.progressMap:[{progress:1,imageUrl:e.url}]})})})},e.id))})},"image-editor-option-nav")};var C=a(40016),E=a(67153),_=a(75500),M=a(66408),P=a(69643),A=a(23232),T=a(4878),R=a(70888),D=a(59075),O=a(97960),z=a(44347),U=a(74995),L=a(14908);let B=e=>{let{isEditingCurrentImage:t,setIsPeekingParent:a,isPeekingParent:i,focusedImage:n,parentImageUrl:r,generatedImageHeight:l,generatedImageWidth:o,isFinalImageLoaded:d,setIsFinalImageLoaded:c,isParentImageLoaded:u,setIsParentImageLoaded:m}=e,[p,g]=(0,y.useState)([]),[x,h]=(0,y.useState)(!1),[v,j]=(0,y.useState)(!1),[w,I]=(0,y.useState)(!0),S=(0,y.useMemo)(()=>!!(l&&o),[l,o]),C=(0,y.useMemo)(()=>l&&o?o/l:4/3,[l,o]);return(0,y.useEffect)(()=>{(t||!w)&&(null==n?void 0:n.progressMap)?g(n.progressMap):!t&&(null==n?void 0:n.url)?g(e=>[...e,{progress:1,imageUrl:n.url||""}]):g([])},[t,null==n?void 0:n.url,null==n?void 0:n.progressMap,w]),(0,y.useEffect)(()=>{if(!x)return void a(!1);let e=setTimeout(()=>{x&&!v&&a(!0)},100);return()=>clearTimeout(e)},[x,v,a]),(0,y.useEffect)(()=>{t&&w&&I(!1),t||!d||w||I(!0)},[t,d,w]),(0,s.jsx)("figure",{className:(0,k.cn)("relative group/image w-full max-w-5xl 2xl:max-w-6xl overflow-hidden rounded-lg select-none",!t&&r&&(i?"cursor-grabbing":"cursor-grab")),onDragStart:e=>{if(i)return void e.preventDefault();j(!0)},onDragEnd:()=>{j(!1),h(!1)},onMouseDown:e=>{0===e.button&&h(!0)},onMouseUp:()=>h(!1),onTouchStart:e=>{e.preventDefault(),e.stopPropagation(),h(!0)},onTouchEnd:e=>{e.preventDefault(),h(!1)},onMouseLeave:()=>{h(!1),j(!1)},children:(0,s.jsx)(f.N,{mode:"wait",children:t||!w?S?(0,s.jsx)(b.P.div,{initial:{opacity:0,filter:"blur(4px)"},animate:{opacity:1,filter:"blur(0px)"},exit:{opacity:1,filter:"blur(0px)",transition:{delay:1.5}},transition:{ease:"easeInOut"},className:"h-full mx-auto",style:{aspectRatio:C,maxHeight:l},children:(0,s.jsx)(N.L,{status:"streaming",intermediateResults:p,isModerated:null==n?void 0:n.isModerated,aspectRatio:C})},"streaming-image"):(0,s.jsx)(K,{}):(0,s.jsxs)("div",{className:"flex relative items-center justify-center w-full h-full",children:[(null==n?void 0:n.url)&&(0,s.jsxs)(s.Fragment,{children:[!d&&(0,s.jsx)(K,{className:"absolute z-20 inset-0"}),(0,s.jsx)(b.P.img,{variants:{hidden:{opacity:0,filter:"blur(4px)"},visible:{opacity:1,filter:"blur(0px)"}},exit:"hidden",animate:r&&i||!d?"hidden":"visible",transition:{ease:"easeInOut"},src:n.url,alt:"active-image",className:"max-h-full aspect-auto rounded-lg",onLoad:()=>c(!0)},"finished-image")]}),(0,s.jsx)(f.N,{children:!t&&r&&i&&(0,s.jsxs)(b.P.div,{variants:{hidden:{opacity:0,filter:"blur(4px)"},visible:{opacity:1,filter:"blur(0px)"}},initial:"hidden",exit:"hidden",animate:"visible",transition:{ease:"easeInOut"},className:"absolute z-10 w-full h-full flex items-center overflow-hidden",children:[!u&&(0,s.jsx)(K,{className:"absolute z-20 inset-0"}),(0,s.jsx)(b.P.img,{variants:{hidden:{opacity:0,filter:"blur(4px)"},visible:{opacity:1,filter:"blur(0px)"}},animate:u?"visible":"hidden",src:r,alt:"parent-image",className:"max-h-full aspect-auto mx-auto rounded-lg",onLoad:()=>m(!0)},"parent-image")]},"parent-image-container")})]})})})},K=e=>{let{className:t}=e;return(0,s.jsx)(b.P.div,{initial:{opacity:0,filter:"blur(4px)"},animate:{opacity:1,filter:"blur(0px)"},transition:{ease:"easeInOut"},className:(0,k.cn)("h-full w-full flex items-center justify-center animate-pulse-lg",t),children:(0,s.jsx)(m.xfq,{size:60,strokeWidth:1.3,className:"opacity-30 rotate-[-10deg]"})},"loader")};var H=a(41320),q=a(4423),F=a(43035),G=a(93220),W=a(34500),V=a(73772);let $=e=>{let{hasImage:t,onSend:a,isStreaming:i}=e,{editImagePresets:n}=(0,g.F)(),r=(0,H.Di)(),{t:l}=(0,j.Bd)("image-editor"),[o,d]=(0,y.useState)(null),[c,u]=(0,y.useState)(null),x=(0,y.useMemo)(()=>i||!t,[i,t]),h=(0,y.useCallback)(e=>{d(t=>t===e?null:e)},[d]),v=(0,y.useCallback)(e=>{if(!i)return d(null),a(e.prompt,e.presetId)},[i,a]),f=(0,y.useCallback)(()=>{if(!i)return d(null),a("Make video","make-video")},[i,a]),w=(0,y.useCallback)(e=>{let t=document.querySelector('[data-preset-id="'.concat(e,'"]'));if(!t)return{};let a=t.getBoundingClientRect();return a.right+12+200>window.innerWidth?{left:a.left-200-12,top:a.top+(a.height-150)/2}:{left:a.right+12,top:a.top+(a.height-150)/2}},[]);return(0,y.useEffect)(()=>{if(!o||r)return void u(null);let e=()=>{let e=document.body.querySelector("[data-highlighted][data-preset-id]"),t=(null==e?void 0:e.getAttribute("data-preset-id"))||null;t&&u(t)};e();let t=new MutationObserver(e);return t.observe(document.body,{attributes:!0,attributeFilter:["data-highlighted"],subtree:!0}),()=>{t.disconnect()}},[o,r]),(0,s.jsxs)("div",{className:"@container flex w-full xs:justify-center justify-start items-center overflow-x-auto xs:overflow-visible gap-2 xs:gap-3 relative z-30 no-scrollbar",children:[(0,s.jsx)(b.P.div,{variants:{hidden:{opacity:0,y:10},visible:{opacity:1,y:0}},initial:"hidden",animate:"visible",transition:{duration:.15,ease:"easeInOut"},className:"bg-surface-base rounded-full",children:(0,s.jsxs)(p.$n,{variant:"filledSecondary",size:"md",className:"flex items-center justify-start py-3 border border-border-l1 rounded-3xl hover:text-fg-primary",onClick:f,children:[(0,s.jsx)(m.jGG,{fill:"currentColor",strokeWidth:0,className:"size-4"}),l("button.make-video","Make video")]},"make-video")},"make-video-animation"),n.map((e,t)=>(0,s.jsx)(b.P.div,{variants:{hidden:{opacity:0,y:10},visible:{opacity:1,y:0}},initial:"hidden",animate:"visible",transition:{duration:.15,ease:"easeInOut",delay:.06*(t+1)},className:"bg-surface-base rounded-full",children:r?(0,s.jsxs)(W._s,{open:e.category===o,onOpenChange:t=>{t?d(e.category):d(null)},children:[(0,s.jsx)(W.Uz,{disabled:x,asChild:!0,children:(0,s.jsx)(Y,{category:e,disabled:x})}),(0,s.jsxs)(W.zj,{className:"max-h-[90dvh]",children:[(0,s.jsx)(W.BE,{children:(0,s.jsxs)(W.gk,{className:"flex items-center justify-center gap-2",children:[e.icon&&y.createElement(e.icon,{size:20,className:"text-secondary flex-shrink-0"}),e.label]})}),(0,s.jsx)("div",{className:"p-2 space-y-2 overflow-auto",children:e.presets.map(e=>(0,s.jsxs)(p.$n,{variant:"ghost",size:"lg",className:"w-full flex items-center justify-start gap-3 h-auto py-3",onClick:()=>v(e),children:[e.icon&&y.createElement(e.icon,{size:18,className:"text-secondary flex-shrink-0"}),(0,s.jsx)("span",{children:e.label})]},e.presetId))})]})]}):(0,s.jsxs)(V.rI,{open:e.category===o,onOpenChange:()=>h(e.category),children:[(0,s.jsx)(V.ty,{disabled:x,asChild:!0,children:(0,s.jsx)(Y,{category:e,disabled:x})}),(0,s.jsx)(V.SQ,{hideWhenDetached:!0,side:"top",sideOffset:8,className:"min-w-60 space-y-0.5 z-[100000]",onMouseLeave:()=>{u(null)},onWheel:e=>e.stopPropagation(),onKeyDown:e=>e.stopPropagation(),children:e.presets.map(t=>(0,s.jsxs)(V._2,{"data-preset-id":t.presetId,className:"flex items-center gap-2",onSelect:()=>v(t),children:[t.icon&&y.createElement(t.icon,{size:16,className:"text-secondary flex-shrink-0"}),t.label,c===t.presetId&&(0,F.createPortal)((0,s.jsxs)(b.P.div,{layoutId:"preset-preview",className:"fixed w-[200px] h-[150px] bg-surface-l4 border border-border-l1 rounded-2xl shadow-lg z-50 pointer-events-none flex items-center justify-center p-1.5",style:w(t.presetId),children:[(0,s.jsx)(G.$,{className:"absolute inset-0"}),t.previewUrl&&(0,s.jsx)(q.default,{src:t.previewUrl,alt:t.presetId,width:200,height:150,priority:!r&&o===e.category,className:"w-full h-full object-cover rounded-xl relative z-10"})]}),document.body)]},t.presetId))})]})},e.category))]})},Y=y.forwardRef((e,t)=>{let{category:a,disabled:i,...n}=e;return(0,s.jsxs)(p.$n,{ref:t,size:"md",variant:"filledSecondary",rounded:!0,className:(0,k.cn)(!i&&"*:hover:text-primary transition-all"),disabled:i,...n,children:[a.icon&&y.createElement(a.icon,{size:16,className:"flex-shrink-0 text-secondary transition-colors"}),(0,s.jsx)("span",{children:a.label})]})});var Q=a(24734);let X=e=>{let{onUploadImage:t}=e,{t:a}=(0,j.Bd)("base"),i=(0,R.x)(U.A("fetchUploadFile")),n=(0,R.x)(U.A("removeByConversationId")),r=(0,o.aP)(U.A("conversationId")),{ASSET_SERVER_URL:l}=(0,c.v)(),d=(0,Q.K)(),u=(0,y.useRef)(null),[g,x]=(0,y.useState)(!1),[h,v]=(0,y.useState)(!1),I=(0,y.useCallback)(()=>{var e;null==(e=u.current)||e.click()},[]),N=(0,y.useCallback)(async e=>{let s;if(1!==e.length||!e[0])return void L.oR.error(a("Only a single image file is allowed","Only a single image file is allowed"));if(!["image/png","image/jpeg","image/jpg","image/webp"].includes(e[0].type))return void L.oR.error(a("Only image files are allowed","Only image files are allowed"));v(!0);try{let t=i(e[0],r||"no_conversation_id");s=await t.metadataPromise}catch(e){d("image-editor-upload:uploadFile",e)}s instanceof Error&&d("image-editor-upload:uploadFile",s,a("Failed to upload file","Failed to upload file")),v(!1),n(r||"no_conversation_id"),!s||s instanceof Error||t({url:(0,T.sU)(l,s.fileUri),metadata:s})},[a,i,r,t,l,n,d]),k=(0,y.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),h||x(!0)},[h]),S=(0,y.useCallback)(e=>{e.preventDefault(),e.stopPropagation(),x(!1)},[]),C=(0,y.useCallback)(e=>{if(e.preventDefault(),e.stopPropagation(),x(!1),!h)return N(Array.from(e.dataTransfer.files))},[N,h]),E=(0,y.useCallback)(e=>{if(e.target.files)return N(Array.from(e.target.files)).finally(()=>{u.current&&(u.current.value="")})},[N]);return(0,s.jsx)(b.P.div,{initial:{opacity:0},animate:{opacity:1},onDragOver:k,onDragLeave:S,onDrop:C,className:"border resize transition-colors w-full max-w-7xl h-full flex justify-center items-center border-border-l1 rounded-2xl p-8 mb-3 text-center ".concat(g&&!h&&"bg-surface-l1 border-border-l1"),children:(0,s.jsxs)("div",{className:"flex flex-col items-center gap-4",children:[(0,s.jsx)("div",{className:"p-4 rounded-full text-fg-secondary transition-colors bg-surface-l1",children:(0,s.jsx)(f.N,{mode:"popLayout",children:g&&!h?(0,s.jsx)(b.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:(0,s.jsx)(m.sv7,{className:"size-6"})},"files"):(0,s.jsx)(b.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:(0,s.jsx)(m.XGR,{className:"size-6"})},"image-plus")})}),(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium text-primary",children:a("Upload an image to begin","Upload an image to begin")}),(0,s.jsx)(f.N,{mode:"popLayout",children:h?(0,s.jsx)(b.P.p,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"text-sm text-fg-secondary",children:a("Uploading image","Uploading image")},"uploading"):g?(0,s.jsx)(b.P.p,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"text-sm text-fg-secondary",children:a("Drop image here","Drop image here")},"dragging"):(0,s.jsx)(b.P.p,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"text-sm text-fg-secondary",children:a("Drag and drop to upload","Drag and drop to upload")},"not-dragging")})]}),(0,s.jsx)("div",{className:"flex gap-3",children:(0,s.jsxs)(p.$n,{variant:"outline",className:"text-fg-primary hover:bg-button-ghost-hover rounded-2xl transition-all py-2.5 px-4 h-auto *:hover:text-fg-primary *:hover:transition-colors",disabled:h,autoFocus:!0,onClick:I,children:[h?(0,s.jsx)(w.y,{size:"xxs"}):(0,s.jsx)(m._OO,{className:"size-4 text-fg-secondary"}),a("Upload","Upload")]})}),(0,s.jsx)("input",{ref:u,className:"hidden",type:"file",accept:"image/png,image/jpeg,image/jpg,image/webp",onChange:E,multiple:!1,"data-testid":"file-input"})]})})};var J=a(63278);let Z=()=>{let{ASSET_SERVER_URL:e}=(0,c.v)(),t=(0,_.h)(),a=(0,A._)(),{t:i}=(0,j.Bd)("base"),n=(0,E.L)(),{handleSendStart:r,timeToSendStart:l,consumeTimeToSendMs:u}=(0,M.Q)(),[m,p]=(0,P.M)("image-editor-first-open",!0),g=(0,D.j)(U.A("isOpen")),x=(0,D.j)(U.A("currentImage")),h=(0,D.j)(U.A("setImage")),b=(0,o.aP)(U.A("conversationId")),w=(0,o.aP)(U.A("streamedMessageId")),N=(0,o.aP)(U.A("lastMessageId")),k=(0,O.A3)(e=>e.byId[null!=w?w:""]),K=(0,O.A3)(U.A("byId")),H=(0,y.useMemo)(()=>{var e;return null!=(e=O.A3.getState().byConversationId[null!=b?b:""])?e:[]},[b]),q=(0,J.S)(),[F,G]=(0,y.useState)(""),[W,V]=(0,y.useState)(!1),[Y,Q]=(0,y.useState)(null),[Z,ee]=(0,y.useState)(!1),[et,ea]=(0,y.useState)(!1),[es,ei]=(0,y.useState)(!1),[en,er]=(0,y.useState)(!1),[el,eo]=(0,y.useState)(!1),ed=(0,y.useMemo)(()=>!!x,[x]),ec=(0,y.useMemo)(()=>!!(x&&"key"in x),[x]),eu=(0,y.useMemo)(()=>!!(x&&"metadata"in x),[x]),em=(0,y.useMemo)(()=>{if(ec){if(W)return!Y&&k&&Q(k.responseId),k||K[null!=Y?Y:""];let e=H.filter(e=>e.streamingImageById).find(e=>{for(let t in e.streamingImageById){let a=e.streamingImageById[t][100];if((null==a?void 0:a.imageUrl)===(null==x?void 0:x.url))return!0}});return e||(null==H?void 0:H.find(e=>{var t,a;return null==(t=e.generatedImageUrls)?void 0:t.includes(null!=(a=x.assetKey)?a:"")}))}},[x,H,ec,W,k,Y,K]),ep=(0,y.useMemo)(()=>(null==em?void 0:em.parentResponseId)?K[em.parentResponseId]:void 0,[em,K]),eg=(0,y.useMemo)(()=>ep?(0,T.sU)(e,ep.imageEditUri):void 0,[ep,e]),ex=(0,y.useMemo)(()=>{if(eu){var t,a;return[{id:null!=(t=x.metadata.fileUri)?t:"",url:null!=(a=(0,T.sU)(e,x.metadata.fileUri))?a:"",isModerated:!1,progressMap:void 0}]}return ec?em?W&&em.streamingImageById?Object.entries(em.streamingImageById).map(t=>{var a;let[s,i]=t,n=Object.keys(i).map(Number),r=i[Math.max(...n)];return{id:s,url:null!=(a=(0,T.sU)(e,null==r?void 0:r.imageUrl))?a:"",isModerated:!1,progressMap:n.map(t=>{var a,s;return{progress:t/100,imageUrl:null!=(s=(0,T.sU)(e,null==(a=i[t])?void 0:a.imageUrl))?s:""}})}}):em.generatedImageUrls.map(t=>{var a,s,i;let n=null!=(s=Object.values(null!=(a=em.streamingImageById)?a:{})[0])?s:{},r=Object.keys(n).map(Number);return{id:t,url:null!=(i=(0,T.sU)(e,t))?i:"",isModerated:!1,progressMap:r.length>0?r.map(t=>{var a,s;return{progress:t/100,imageUrl:null!=(s=(0,T.sU)(e,null==(a=n[t])?void 0:a.imageUrl))?s:""}}):void 0}}):[]:[]},[x,em,ec,W,e,eu]),eh=(0,y.useMemo)(()=>ex.length>1?ex.find(e=>e.id===(null==x?void 0:x.key)||e.id===(null==x?void 0:x.assetKey)):ex[0],[ex,x]),ev=(0,y.useMemo)(()=>(0,s.jsx)(B,{isEditingCurrentImage:W,focusedImage:eh,parentImageUrl:en?void 0:eg,isPeekingParent:Z,setIsPeekingParent:ee,generatedImageWidth:null==em?void 0:em.generatedImageWidth,generatedImageHeight:null==em?void 0:em.generatedImageHeight,isParentImageLoaded:es,isFinalImageLoaded:el,setIsFinalImageLoaded:eo,setIsParentImageLoaded:ei}),[W,eh,Z,eg,null==em?void 0:em.generatedImageWidth,null==em?void 0:em.generatedImageHeight,es,el,en]),ef=(0,y.useCallback)(()=>{(null==eh?void 0:eh.url)&&q(eh.url).catch(e=>{(0,v.vV)("image-editor:handleMakeVideo",e)})},[null==eh?void 0:eh.url,q]),eb=(0,y.useCallback)(e=>{e&&h(e)},[h]),ey=(0,y.useCallback)(e=>{let t=ex[e];t&&(W&&h({key:t.id}),h({key:t.id,assetKey:t.id,url:t.url,isModerated:t.isModerated,progress:(null==t?void 0:t.progressMap)?Math.max(...Object.keys(t.progressMap).map(Number)):1}))},[ex,W,h]),ej=(0,y.useCallback)(async e=>(ea(!0),e().finally(()=>{ea(!1)})),[]),ew=(0,d.m)("image-workbench:handleAbort",ej),eI=(0,y.useCallback)(async(e,a)=>{if(!e.trim()||!(null==x?void 0:x.url))throw Error("No message or image");let s=o.aP.getState(),i=z.C$.getState(),r=O.A3.getState(),l=R.x.getState(),d=a.replace(/^https?:\/\/[^/]+\/?/,"");G(""),l.removeByConversationId(s.conversationId||"no_conversation_id"),l.removeAttachByConversationId(s.conversationId||"no_conversation_id"),await n();let c=s.lastMessageId?r.byId[s.lastMessageId]:void 0;if(s.lastMessageId&&!c)throw Error("Last message is missing");if((null==c?void 0:c.sender)==="human")throw Error("Last message is human");"none"!==s.reasoningMode&&s.setReasoningMode("none");let u={message:e,toolOverrides:{imageGen:!0},imageEditUri:d,enableRetries:t.ENABLE_AUTO_STREAM_RETRY},m=eu&&x.metadata.fileMetadataId&&!(null==ep?void 0:ep.message)?[x.metadata.fileMetadataId]:[];if(eu)return s.conversationId?s.sendResponse({...u,parentResponseId:s.lastMessageId,conversationId:s.conversationId,fileAttachmentIds:m,webpageUrls:[],setOpimisticUserResponse:!0,setUserResponse:!0,ff:t}):s.establishNewConversation({...u,fileAttachmentIds:[x.metadata.fileMetadataId],temporary:i.isIncognito,ff:t});if(!s.conversationId)throw Error("No conversation id");return s.sendResponse({...u,parentResponseId:s.lastMessageId,conversationId:s.conversationId,fileAttachmentIds:m,webpageUrls:[],setOpimisticUserResponse:!0,setUserResponse:!0,ff:t})},[x,n,eu,ep,t]),eN=(0,y.useCallback)(async(e,t)=>{let a=o.aP.getState(),s=O.A3.getState(),i=a.streamedMessageId?s.byId[a.streamedMessageId]:void 0;return["streaming","optimistic","reconnecting"].includes((null==i?void 0:i.state)||"closed")&&await ew(),V(!0),eI(e,t).catch(()=>{D.j.getState().close()})},[eI,ew]),ek=(0,y.useCallback)(async(e,t)=>{if(e.trim()&&(null==eh?void 0:eh.url))return(a("edit_image_start",(0,M.r)(eh.url),{queryType:t?"preset":"manual",location:"image-editor",presetId:t||"",message:e,messageLength:String(e.length),timeToSendMs:String(u())}),"make-video"===t)?ef():eN(e,eh.url).catch(e=>{(0,v.vV)("image-viewer:ImageEditor:handleEditCurrentImage",e)})},[eN,eh,a,u,ef]),eS=(0,y.useCallback)(()=>{if((null==ep?void 0:ep.message)&&eg)return a("edit_image_start",(0,M.r)(eg),{queryType:"regenerate",location:"image-editor",presetId:"",message:null==ep?void 0:ep.message,messageLength:String(null==ep?void 0:ep.message),timeToSendMs:String(u())}),eN(ep.message,eg).catch(e=>{(0,v.vV)("image-viewer:ImageEditor:handleRegenerate",e)})},[ep,eg,eN,a,u]);(0,y.useEffect)(()=>{W&&ex.length&&ex[0]&&!ex.find(e=>e.id===x.key)&&h({key:ex[0].id})},[ex,W,x,h]),(0,y.useEffect)(()=>{let t=D.j.getState();if(W&&k&&"error"===k.state)return t.close();if(W&&Y&&k&&"closed"===k.state){var s,i,n,r;if(V(!1),Q(null),!N)return t.close();let l=K[N];if(!l)return t.close();let o=null==(n=l.streamingImageById)||null==(i=n[null!=(r=null==x?void 0:x.key)?r:""])||null==(s=i[100])?void 0:s.imageUrl;if(!o)return t.close();a("edit_image_end",(0,M.r)((null==ep?void 0:ep.imageEditUri)||""),{location:"image-editor"}),h({key:o,assetKey:o,url:(0,T.sU)(e,o),progress:100,isModerated:!1})}},[ep,k,W,Y,N,K,e,a,h]),(0,y.useEffect)(()=>{W||et||void 0!==l||r()},[u,r,W,et,l]),(0,y.useEffect)(()=>{if(null==eh?void 0:eh.url){eo(!1);let e=new Image;e.onload=()=>eo(!0),e.src=eh.url}},[null==eh?void 0:eh.url]),(0,y.useEffect)(()=>{if(eg){ei(!1),er(!1);let e=new Image;e.onload=()=>ei(!0),e.onerror=()=>er(!0),e.src=eg}},[eg]),(0,y.useEffect)(()=>{m&&g&&(p(!1),L.oR.message((0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-fg-primary font-bold",children:i("image-editor-welcome.title","Welcome to Image Editor")}),(0,s.jsx)("p",{className:"text-fg-secondary",children:i("image-editor-welcome.description","A focused space for you to transform images with Grok to anything you can imagine.")})]}),{duration:7e3}))},[m,g,p,i]);let eC=(0,D.j)(U.A("close"));return(0,s.jsxs)("div",{className:"flex flex-col items-center justify-between gap-6 sm:gap-20 w-full h-full",children:[(0,s.jsx)(I,{hasImage:ed,prompt:eg?null==ep?void 0:ep.message:void 0,focusedImageUrl:null==eh?void 0:eh.url,parentImageUrl:en?void 0:eg,isStreaming:W||et,onParentPeek:e=>ee(e),onClose:eC,onRegenerate:eS}),ed?ev:g&&(0,s.jsx)(X,{onUploadImage:eb}),(0,s.jsx)("footer",{className:"relative w-full max-w-2xl h-16 flex-shrink-0 mt-12 sm:mt-0",children:(0,s.jsxs)("div",{className:"absolute bottom-0 inset-x-0 flex flex-col gap-4",children:[(0,s.jsx)(f.N,{mode:"popLayout",children:ed&&ex&&ex.length>1&&(0,s.jsx)(S,{isStreaming:W||et,images:ex,focusedOption:ex.findIndex(e=>e.id===(null==eh?void 0:eh.id))||0,onSelect:ey})}),(0,s.jsx)($,{hasImage:ed,isStreaming:W||et,onSend:ek}),(0,s.jsx)(C.q,{hasImage:ed,inputValue:F,isStreaming:W||et,onInputValueChange:G,onSend:ek,onAbort:ew})]})})]})};var ee=a(13103),et=a(53592),ea=a(84852);let es=()=>{let{t:e}=(0,j.Bd)("base"),t=(0,A._)(),a=(0,D.j)(U.A("isOpen")),i=(0,D.j)(U.A("close")),n=(0,o.aP)(U.A("conversationId")),[r,l]=(0,y.useState)(void 0),{handleEditorOpen:d,consumeEditorTimeMs:c,editorOpenTime:u}=(0,M.Q)();return(0,y.useEffect)(()=>{a&&void 0===u?d():a||void 0===u||t("image_editor_close",void 0,{timeInEditorMs:String(c()),location:"image-editor-dialog"})},[a,d,c,t,u]),(0,y.useEffect)(()=>{n!==r&&(r&&i(),l(n))},[n,i,r]),(0,s.jsx)(et.lG,{open:a,onOpenChange:e=>{e||i()},children:(0,s.jsxs)(ee.ZJ,{children:[(0,s.jsx)(et.LC,{className:"fixed inset-0 z-50 bg-overlay duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0"}),(0,s.jsxs)(et.Cf,{"aria-describedby":e("image-editor.title","Image editor"),className:(0,k.cn)("fixed z-50 inset-0 bg-background duration-200 focus:outline-none","data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 p-2 lg:p-6"),onCloseAutoFocus:e=>{e.preventDefault(),document.body.style.pointerEvents=""},children:[(0,s.jsx)(ea.s,{children:(0,s.jsx)(ee.L3,{children:e("image-editor.title","Image editor")})}),(0,s.jsx)(Z,{})]})]})})};var ei=a(81884),en=a(49972),er=a(41739),el=a(68332);let eo=e=>{let t=(0,y.useRef)(null);return(0,y.useEffect)(()=>{let a=a=>{t.current&&!t.current.contains(a.target)&&e()};return document.addEventListener("mousedown",a),()=>document.removeEventListener("mousedown",a)},[e]),t};var ed=a(86035),ec=a(86067),eu=a(62903),em=a(38541),ep=a.n(em),eg=a(2376),ex=a(35181),eh=a(18585),ev=a(80226);let ef=(0,y.forwardRef)((e,t)=>{let{onSelect:a,tab:i,onRemove:n,isEditing:r,newTitle:l,onNewTitleChange:o,onEditStart:d,onEditSave:c,onEditCancel:u,isActive:g=!1,isDragging:x=!1,isStreaming:h=!1,isLoading:v=!1,isReconnecting:f=!1,showActions:b,className:w,...I}=e,{t:N}=(0,j.Bd)("base"),S=(0,en.w1)(U.A("fetchGetConversation")),C=(0,ex.v)(S(i.conversationId));(0,y.useEffect)(()=>{if(C.data&&(C.data.temporary!==i.isTemporary||C.data.title!==i.title)){let{upsertConversationAsTab:e}=er.a.getState();e(C.data,i.conversationId)}},[C.data,i]);let E=(0,y.useCallback)(e=>{("keydown"!==e.type||"Enter"===e.key)&&(x||(e.preventDefault(),a(i.conversationId)))},[i.conversationId,a,x]),_=(0,y.useCallback)(e=>{e.stopPropagation(),n(i.conversationId)},[i.conversationId,n]),M=(0,y.useCallback)(e=>{e.stopPropagation(),("click"===e.type||e instanceof KeyboardEvent&&"Enter"===e.key)&&d(i.conversationId)},[d,i.conversationId]),P=(0,y.useCallback)(e=>{e.stopPropagation(),("click"===e.type||e instanceof KeyboardEvent&&"Enter"===e.key)&&c(i.conversationId)},[c,i.conversationId]),A=(0,y.useCallback)(e=>{o(e.target.value)},[o]),T=(0,y.useCallback)(e=>{e.stopPropagation(),"Enter"===e.key?c(i.conversationId):"Escape"===e.key&&u()},[u,c,i.conversationId]),R=(0,y.useMemo)(()=>{var e;if(i.isTemporary)return N("Temporary Chat","Temporary Chat");if(i.title)return i.title;if(null==(e=C.data)?void 0:e.createTime){let e=new Date(C.data.createTime);return"".concat(N("Chat on","Chat on")," ").concat(e.toLocaleDateString())}return N("Untitled Chat","Untitled Chat")},[N,i,C.data]);return v?(0,s.jsx)(ev.E,{className:"w-full h-10 my-1 rounded-2xl"}):(0,s.jsxs)("div",{...I,ref:t,className:(0,k.cn)("group pl-3 pr-1 py-1 text-sm hover:bg-button-ghost-hover w-full h-10 flex items-center rounded-2xl border gap-1.5","focus:outline-none focus-visible:ring-1 ring-ring ring-inset",g?"bg-button-ghost-hover text-fg-primary border-border-l1":"text-fg-secondary border-transparent",w),onClick:E,onKeyDown:E,tabIndex:0,role:"button",children:[r?(0,s.jsx)("input",{className:"w-full bg-transparent focus-visible:outline-none",value:l,onKeyDown:T,onChange:A,autoFocus:!0}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(eb,{isStreaming:h,isReconnecting:f,conversation:C.data}),(0,s.jsx)("span",{className:(0,k.cn)("flex-1 select-none text-nowrap max-w-full overflow-hidden inline-block",!i.isPreserved&&"italic"),style:{maskImage:"linear-gradient(to right, black 85%, transparent 100%)",WebkitMaskImage:"linear-gradient(to right, black 85%, transparent 100%)"},children:R})]}),r?(0,s.jsxs)("div",{className:"flex items-center justify-end gap-1",children:[(0,s.jsx)(p.gx,{variant:"ghost",size:"iconSm",rounded:!0,onClick:e=>{e.stopPropagation(),u()},tooltipContent:N("Cancel","Cancel"),tooltipContentProps:{hideWhenDetached:!0},children:(0,s.jsx)(m.uv5,{size:16,className:"text-fg-primary"})}),(0,s.jsx)(p.gx,{variant:"ghost",size:"iconSm",rounded:!0,onClick:P,tooltipContent:N("Save","Save"),tooltipContentProps:{hideWhenDetached:!0},children:(0,s.jsx)(m.Srz,{size:16,className:"text-fg-primary"})})]}):(0,s.jsxs)("div",{className:"flex items-center justify-end",children:[!i.isTemporary&&!x&&(0,s.jsx)(p.gx,{tabIndex:-1,className:(0,k.cn)("hidden group-hover:flex group-focus-visible:flex text-fg-secondary",b&&"flex"),onClick:M,variant:"ghost",size:"iconSm",rounded:!0,tooltipContent:N("Rename","Rename"),tooltipContentProps:{hideWhenDetached:!0},children:(0,s.jsx)(m.rZj,{})}),!x&&(0,s.jsx)(p.gx,{className:(0,k.cn)("hidden group-hover:flex group-focus-visible:flex text-fg-secondary",b&&"flex"),onClick:_,variant:"ghost",size:"iconSm",rounded:!0,tooltipContent:N("Close","Close"),tooltipContentProps:{hideWhenDetached:!0},children:(0,s.jsx)(m.uv5,{})})]})]})}),eb=e=>{let{conversation:t}=e,{personaById:a}=(0,eg.v5)(),i=(0,y.useMemo)(()=>{if(!(null==t?void 0:t.personaId)||!(0,eg.sS)(t.personaId))return;let e=a[t.personaId];if(e)return{...e,...(0,eh.e8)(e.personaId)}},[null==t?void 0:t.personaId,a]);return(null==t?void 0:t.temporary)?(0,s.jsx)(m.fz0,{className:"h-4 w-4"}):i&&(0,s.jsx)("span",{className:(0,k.cn)("[&>svg]:h-4 [&>svg]:w-4",i.colorClassName),children:i.icon})};var ey=a(85703);function ej(e){let{id:t,element:a,children:i,options:n,isDragging:r,disabled:l=!1}=e,{attributes:o,listeners:d,setNodeRef:c,transform:u,transition:m}=(0,eu.gl)({id:t,transition:{duration:150,easing:"cubic-bezier(0.25, 1, 0.5, 1)"},disabled:l,...n}),p={transform:ey.Ks.Transform.toString(u),transition:m,opacity:+!r};return(0,s.jsx)(a||"div",{ref:c,...d,...o,style:p,children:i})}let ew=()=>{let{routeToConversation:e}=(0,el.o)(),t=(0,A._)(),a=(0,Q.K)(),i=(0,er.a)(U.A("drawerOpen")),n=(0,er.a)(U.A("menuFixed")),r=(0,er.a)(U.A("menuHidden")),l=(0,er.a)(U.A("tabByConversationId")),d=(0,er.a)(U.A("inEditId")),c=(0,o.aP)(U.A("conversationId")),[u,g]=(0,y.useState)(),[h,f]=(0,y.useState)(""),[w,I]=(0,y.useState)(!1);!function(){let e=(0,o.aP)(U.A("conversationId"));(0,y.useEffect)(()=>{if(e){let{upsertConversationAsTab:t,tabByConversationId:a}=er.a.getState(),{fetchGetConversation:s}=en.w1.getState();a[e]||s(e).then(e=>{t(e,void 0,!1)}).catch((0,v.HX)("use-observe-conversation-id:fetchGetConversation"))}},[e])}();let N=(0,x.c)(),{t:S}=(0,j.Bd)("base"),C=(0,y.useMemo)(()=>Object.values(l).sort((e,t)=>e.index-t.index),[l]),E=(0,y.useCallback)(a=>{let s=l[a];if(a===c){if(!s)return;if(0===s.index){let t=C[s.index+1];t?e(t.conversationId,s.isTemporary):e(void 0)}else{let t=C[s.index-1];t?e(t.conversationId,s.isTemporary):e(void 0)}}let{removeTab:i}=er.a.getState();i(a),t("close_tab",a,{location:"tabs-manager"})},[c,e,C,t,l]),_=(0,y.useCallback)(e=>{let t=l[e];if(!t)return;let{setInEditId:a}=er.a.getState();a(t.conversationId),f(t.title)},[l]),M=(0,y.useCallback)(async e=>{if(d!==e)return;let s=h.trim();if(""===s)return;let{setInEditId:i}=er.a.getState();try{let{fetchUpdateConversation:a}=en.w1.getState();await a(e,{title:s}),i(void 0),t("update_conversation",e,{location:"tabs-manager"})}catch(e){a("tabs-manager:handleEditSave",e)}},[d,h,t,a]),P=eo(()=>{d&&T()}),T=(0,y.useCallback)(()=>{let{setInEditId:e}=er.a.getState();e(void 0),f("")},[]),R=(0,ed.MS)(ed.cA,{activationConstraint:{distance:8}}),D=(0,ed.FR)(R),O=(0,y.useCallback)(e=>{let{setInEditId:t}=er.a.getState();g(e.active.id),t(void 0)},[]),z=(0,y.useCallback)(e=>{let{appendTabByConversationId:a}=er.a.getState(),{active:s,over:i}=e,n=null==s?void 0:s.id,r=null==i?void 0:i.id;if(n&&r&&n!==r){let e=C.findIndex(e=>e.conversationId===n),t=C.findIndex(e=>e.conversationId===r);if(-1===e||-1===t)return;a((0,eu.be)(C,e,t).map((e,t)=>({...e,index:t})))}g(void 0),t("reorder_tab","",{location:"tabs-manager:handleDragEnd"})},[C,t]),L=(0,y.useCallback)(()=>{g(void 0)},[]),B=(0,y.useCallback)(()=>{let{setMenuHidden:e,toggleMenuFixed:t,menuFixed:a}=er.a.getState();t(),e(!a)},[]),K=(0,y.useCallback)(e=>{let{setMenuHidden:t,setInEditId:a}=er.a.getState();e.clientX>24&&t(!0),a(void 0)},[]),H=(0,y.useCallback)(e=>{let{setMenuHidden:t}=er.a.getState();e.clientX<64&&t(!1)},[]),q=(0,y.useCallback)(()=>{let{setDrawerOpen:e}=er.a.getState();e(!1)},[]),F=(0,y.useCallback)(()=>{let{setTabByConversationId:e,tabByConversationId:a,setDrawerOpen:s}=er.a.getState();e(c?ep().pick(a,c):{}),I(!1),s(!1),t("clear_all_tabs","",{location:"tabs-manager:handleClearAll"})},[c,t]),G=(0,y.useMemo)(()=>{if(!u)return;let{tabByConversationId:e}=er.a.getState();return e[u]},[u]),V=(0,y.useCallback)(a=>{let{setDrawerOpen:s,inEditId:i,upsertTab:n}=er.a.getState();if(a===i)return;T(),s(!1);let r=l[a];r&&(r.isPreserved||n({...r,isPreserved:!0}),e(r.conversationId,r.isTemporary),t("select_conversation",r.conversationId,{location:"tabs-manager"}))},[T,e,t,l]),$=(0,y.useMemo)(()=>C.map(e=>e.conversationId),[C]),Y=(0,y.useMemo)(()=>{let{tabByConversationId:e}=er.a.getState();return Object.values(e).length},[]);return N&&Y>0?(0,s.jsx)(W._s,{open:i,onClose:q,dismissible:!0,children:(0,s.jsxs)(W.zj,{className:"bg-surface-base px-2 max-h-[90vh] focus:outline-none",children:[(0,s.jsxs)(W.BE,{className:"px-2 w-full pb-0 flex items-center h-8 gap-1",children:[(0,s.jsx)(W.gk,{className:"text-primary flex-1 whitespace-nowrap text-sm font-medium truncate text-left",children:S("active-tabs.label",{count:Y,defaultValue_one:"Tab",defaultValue_other:"Tabs"})}),(0,s.jsx)("div",{className:"h-5 min-w-5 p-1 bg-surface-l1 text-xs flex items-center justify-center border border-border-l2 rounded-lg ms-1.5",children:Y}),Y>1&&(0,s.jsx)(p.$n,{className:(0,k.cn)("text-fg-secondary h-6 inline-block w-fit transition-[max-width] duration-200 ease-in-out overflow-hidden px-2",w?"opacity-100 max-w-full":"opacity-70 hover:opacity-100 max-w-6"),onClick:F,variant:"ghost",size:"iconSm",children:(0,s.jsx)(b.P.span,{variants:eI,initial:"initial",animate:"animate",exit:"exit",transition:{duration:.2},className:"flex items-center justify-center whitespace-nowrap",children:w?(0,s.jsx)("span",{className:"text-xs font-medium",children:S("clear-tabs-button.label","Clear")}):(0,s.jsx)(m.uv5,{className:"w-4 h-4"})},w?"clear":"xicon")})]}),(0,s.jsx)("div",{className:(0,k.cn)("flex flex-col z-[200] h-full w-full gap-1 py-4 min-h-[50dvh] overflow-y-auto","mask-image:linear-gradient(to_bottom,transparent_0%,black_16px,black_calc(100%-16px),transparent_100%)","-webkit-mask-image:linear-gradient(to_bottom,transparent_0%,black_16px,black_calc(100%-16px),transparent_100%)"),children:C.map(e=>(0,s.jsx)(ef,{showActions:!0,className:"py-3 rounded-xl",isLoading:!1,isEditing:d===e.conversationId,newTitle:h,onNewTitleChange:f,onEditStart:_,onRemove:E,onEditSave:M,onEditCancel:T,tab:e,onSelect:V,isActive:c===e.conversationId,isDragging:e.conversationId===u},e.conversationId))})]})}):!N&&Y>0?(0,s.jsxs)("div",{ref:P,className:(0,k.cn)("group/menu mx-1 flex flex-col absolute top-16 left-0","max-h-[calc(100dvh-80px)] h-full px-2 py-1 pb-2","z-[200]","border border-border-l1","w-52 @[1440px]/mainview:w-64","bg-surface-l3 shadow-md rounded-3xl","transition-all duration-200 ease-in-out",r?"-translate-x-[220px] @[1440px]/mainview:-translate-x-[268px] px-2 pb-2":"translate-x-0 ",n&&"@7xl/mainview:!translate-x-0 @7xl/mainview:shadow-none @7xl/mainview:bg-surface-base @7xl/mainview:border-0 @7xl/mainview:p-0"),onMouseEnter:H,onMouseLeave:K,children:[(0,s.jsx)("div",{onMouseEnter:H,className:"h-full absolute -right-6 w-6 @4xl/mainview:-right-9 @4xl/mainview:w-9"}),(0,s.jsxs)(ed.Mp,{sensors:D,collisionDetection:ed.fp,onDragStart:O,onDragEnd:z,onDragCancel:L,modifiers:[ec.gj],children:[(0,s.jsx)(eu.gB,{items:$,strategy:eu._G,children:(0,s.jsx)("div",{className:(0,k.cn)("flex flex-col gap-1 h-full overflow-y-auto py-1","mask-image:linear-gradient(to_bottom,transparent_0%,black_4px,black_calc(100%-4px),transparent_100%)","-webkit-mask-image:linear-gradient(to_bottom,transparent_0%,black_4px,black_calc(100%-4px),transparent_100%)"),children:C.map(e=>(0,s.jsx)(ej,{disabled:d===e.conversationId,id:e.conversationId,isDragging:e.conversationId===u,children:(0,s.jsx)(ef,{isEditing:d===e.conversationId,isLoading:!1,newTitle:h,onNewTitleChange:f,onEditStart:_,onRemove:E,onEditSave:M,onEditCancel:T,tab:e,onSelect:V,isActive:c===e.conversationId,isDragging:e.conversationId===u})},e.conversationId))})}),(0,s.jsx)(ed.Hd,{children:G?(0,s.jsx)(e=>{let{tab:t,isMobile:a}=e;return(0,s.jsx)(ef,{onRemove:E,isEditing:d===t.conversationId,newTitle:h,onNewTitleChange:f,onEditStart:_,onEditSave:M,onEditCancel:T,tab:t,onSelect:V,isActive:c===t.conversationId,isDragging:!0,showActions:a,className:(0,k.cn)(a?"py-3 rounded-xl":"","!bg-surface-l3 !text-fg-primary shadow-sm !opacity-100 absolute -translate-y-16 cursor-move z-[100]")},t.conversationId)},{tab:G,isMobile:!1}):null})]}),(0,s.jsxs)("div",{className:" flex items-center group w-full justify-between py-1 h-8 rounded-xl transition-colors focus:outline-none focus-visible:ring-1 ring-ring ring-inset max-w-full",children:[(0,s.jsx)(p.$n,{onClick:F,variant:"ghostSecondary",rounded:!0,size:"sm",className:"opacity-50 group-hover/menu:opacity-100 transition-opacity",children:(0,s.jsx)("span",{className:"text-xs font-medium",children:S("clear-tabs-button.label","Clear")})}),(0,s.jsx)(p.$n,{onClick:B,variant:"ghostSecondary",size:"iconSm",rounded:!0,"aria-label":n?S("toggle-tabs-visibility.close","Hide tabs"):S("toggle-tabs-visibility.lock","Lock tabs"),className:(0,k.cn)("hidden @4xl/mainview:flex opacity-50 group-hover/menu:opacity-100 transition-opacity"),children:(0,s.jsx)(m.O_5,{className:(0,k.cn)("h-4 w-4 transition-transform text-fg-secondary",n?"rotate-0":"rotate-180")})})]})]}):null},eI={initial:{opacity:0,translateX:-1},animate:{opacity:1,translateX:0},exit:{opacity:0,translateX:-1}};var eN=a(48795),ek=a(95739),eS=a(46748),eC=a(89482),eE=a(84499),e_=a(39116),eM=a(10084),eP=a(51459),eA=a(13504),eT=a(5663),eR=a(33231),eD=a(24429),eO=a(71865),ez=a(26067),eU=a(625);let eL=e=>{let{height:t,width:a}=e,{i18n:i}=(0,j.Bd)("chat"),{isSuperGrokUser:n,isSuperGrokProUser:r}=(0,eD.Q2)(),{isSwitchingTeam:o}=(0,eU.hd)(),d=(0,eO.n)(),c=(0,z.C$)(U.A("selectedLanguage")),[u,m]=(0,y.useState)(0),p=(0,y.useMemo)(()=>c||i.languages.find(e=>e in ez.IV)||ez.GG,[c,i.languages]),[g,x]=(0,y.useState)({isSuperGrokProUser:r,isSuperGrokUser:n,usingGrokTeams:d});return(0,y.useEffect)(()=>{o||x(e=>(e.usingGrokTeams!==d&&m(e=>e+1),{isSuperGrokProUser:r,isSuperGrokUser:n,usingGrokTeams:d}))},[r,n,d,o,x]),(0,s.jsx)(f.N,{mode:"wait",initial:!1,children:(0,s.jsx)(b.P.div,{initial:{opacity:1},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2,ease:"easeInOut"},children:g.usingGrokTeams?(0,s.jsx)(l.Mm,{height:t,width:a}):g.isSuperGrokProUser?"ja"===p?(0,s.jsx)(l.bi,{height:t,width:a}):(0,s.jsx)(l.dq,{height:t,width:a}):g.isSuperGrokUser?"ja"===p?(0,s.jsx)(l.cq,{height:t,width:a}):(0,s.jsx)(l.Xd,{height:t,width:a}):"ja"===p?(0,s.jsx)(l.cT,{height:t,width:a}):(0,s.jsx)(l.kk,{height:t,width:a})},"logo-".concat(u))})};var eB=a(82767),eK=a(65912),eH=a(98100),eq=a(44845),eF=a(82127),eG=a(34140),eW=a(73304),eV=a(20301),e$=a(6132);let eY=e$.z.enum(["deepsearch","brainstorm","analyzeData","createImage","code","search","createReport","finance"]),eQ=e$.z.object({type:e$.z.literal("stockMiniSummary"),summary:e$.z.object({ticker:e$.z.string(),name:e$.z.string(),value:e$.z.number(),change:e$.z.number(),changePercent:e$.z.number(),unit:e$.z.string(),market:e$.z.string(),tickerType:e$.z.string()})}),eX=e$.z.discriminatedUnion("type",[eQ]),eJ=e$.z.object({prefix:e$.z.string().optional(),prompt:e$.z.string().optional(),label:e$.z.string(),type:eY,icon:e$.z.string().optional(),payload:eX.optional()});e$.z.object({label:e$.z.string(),prompt:e$.z.string().optional(),type:eY,img:e$.z.string().optional(),description:e$.z.string().optional(),prefix:e$.z.string().optional(),payload:eX.optional()});let eZ=["en"],e0=[{type:"createImage",prefix:"Draw ",label:"Create Images"},{type:"deepsearch",prefix:"Research ",label:"Research"},{type:"brainstorm",prefix:"How ",label:"How to"},{type:"analyzeData",prefix:"Help me ",label:"Analyze"},{type:"code",prefix:"Help me ",label:"Code"}];var e1=a(42557),e2=a(25859);let e3=()=>{let{t:e}=(0,j.Bd)("base"),t=(0,D.j)(U.A("open")),a=(0,A._)(),{user:i}=(0,e1.wV)(),n=(0,e_.useRouter)(),r=(0,y.useCallback)(()=>{if(!i){a("sign_in_redirect",void 0,{location:"edit-image-suggestion-pill"}),n.push("/sign-in");return}a("image_editor_open",void 0,{location:"suggestion-pill"}),t()},[i,t,a,n]);return(0,s.jsxs)(e2.gx,{variant:"secondary",size:"md",shape:"pill",tooltipProps:{delayDuration:100},tooltipContentProps:{side:"bottom",className:"bg-fg-primary text-background"},tooltipContent:i?void 0:e("Sign in to edit images","Sign in to edit images"),onClick:r,children:[(0,s.jsx)(m.mgJ,{size:18,strokeWidth:2,className:"text-secondary"}),(0,s.jsx)("span",{className:"overflow-hidden whitespace-nowrap text-ellipsis",children:e("Edit Image","Edit Image")})]})};var e5=a(50222),e4=a(32507),e6=a(3683);function e8(){let e=(0,A._)(),t=(0,o.aP)(e=>e.projectId),a=(0,o.aP)(e=>e.setProjectId),i=(0,e6.M)(e=>e.loadWorkspace),{t:n}=(0,j.Bd)("base");(0,y.useEffect)(()=>{i(e4.ux)},[i]);let r=(0,y.useCallback)(()=>{e("deepsearch_pill_clicked",void 0,{location:"deepsearch-suggestion-pill",target:"chip"}),a(t===e4.ux?void 0:e4.ux)},[e,t,a]);return(0,s.jsxs)(e2.$n,{variant:"secondary",size:"md",shape:"pill",onClick:r,children:[(0,s.jsx)(e5.A,{size:16,strokeWidth:2,className:"text-secondary"}),n("deep-search","DeepSearch")]})}var e9=a(21782);function e7(e){let{suggestion:t,onClick:a}=e,{label:i}=t,n=(0,y.useCallback)(()=>{a(t)},[a,t]);return(0,s.jsxs)(e2.$n,{size:"md",variant:"secondary",shape:"pill",onClick:n,children:[(0,s.jsx)(tt,{suggestion:t}),(0,s.jsx)("p",{className:"overflow-hidden whitespace-nowrap text-ellipsis",children:i})]})}function te(e){let{suggestions:t,onClick:a,handleSend:i}=e,{user:n}=(0,e1.wV)(),r=(0,_.h)(),l=(0,z.C$)(U.A("isIncognito")),o=!l,d=Math.min(t.length,5)-!!o-!!(n&&!l)-2,c=(0,e9.f)(),u=eZ.includes(c),m=r.SHOW_DEEPSEARCH_SUGGESTION_PILL;return(0,s.jsx)("div",{className:"flex flex-col gap-2",children:(0,s.jsxs)("div",{className:"flex flex-row flex-wrap w-full gap-2 @sm:gap-2 justify-center items-center",children:[m&&(0,s.jsx)(e8,{}),u&&t.slice(0,d).map(e=>{let t=e.type+e.prefix+e.prompt;return(0,s.jsx)(e7,{suggestion:e,onClick:a},t)}),o&&!m&&(0,s.jsx)(e3,{}),(0,s.jsx)(eh.Ph,{handleSend:i})]})})}function tt(e){let{suggestion:t}=e,[a,i]=(0,y.useState)(!1),[n,r]=(0,y.useState)(!0);return t.icon&&!a?(0,s.jsxs)(s.Fragment,{children:[n&&(0,s.jsx)(ts,{suggestion:t}),(0,s.jsx)("img",{src:t.icon,alt:"".concat(t.type," icon"),className:"me-2 h-[18px] w-[18px] object-contain",onError:()=>i(!0),onLoad:()=>r(!1),style:{display:n?"none":"block"}})]}):(0,s.jsx)(ts,{suggestion:t})}let ta={className:"text-secondary",strokeWidth:2,size:18};function ts(e){let{suggestion:t}=e;switch(t.type){case"deepsearch":return(0,s.jsx)(m.Dd5,{...ta});case"brainstorm":return(0,s.jsx)(m.KqI,{...ta});case"analyzeData":case"createReport":return(0,s.jsx)(m.EsT,{...ta});case"createImage":return(0,s.jsx)(m.XGR,{...ta});case"code":return(0,s.jsx)(m.CyN,{...ta});default:return(0,s.jsx)(s.Fragment,{})}}var ti=a(42151),tn=a(58939),tr=a(76393),tl=a(10463);function to(e){var t,a,i,n,r,l,o,d,c,u,p,g,x,h,v,f,b,y,w,I,N,S,C;let{suggestion:E}=e,_={type:"finance",label:null!=(v=(o=E.summary).ticker)?v:"",payload:{type:"stockMiniSummary",summary:{ticker:null!=(f=o.ticker)?f:"",name:null!=(b=null==(d=o.stockOverview)?void 0:d.name)?b:"",value:null!=(y=null==(c=o.financeValue)?void 0:c.value)?y:0,change:null!=(w=null==(u=o.financeValue)?void 0:u.change)?w:0,changePercent:null!=(I=null==(p=o.financeValue)?void 0:p.changePercent)?I:0,unit:null!=(N=null==(g=o.financeValue)?void 0:g.unit)?N:"",market:null!=(S=null==(x=o.stockOverview)?void 0:x.market)?S:"",tickerType:null!=(C=null==(h=o.stockOverview)?void 0:h.tickerType)?C:""}}}.payload,{i18n:M}=(0,j.Bd)("finance"),P=null!=(a=_.summary.value)?a:0,A=null!=(i=_.summary.change)?i:0,T=null!=(n=_.summary.changePercent)?n:0,R=(null==(t=E.summary.stockOverview)?void 0:t.currency)||"USD",D=(null!=(l=null!=(r=_.summary.name)?r:_.summary.ticker)?l:"").replace(" Common Stock",""),O=tl.s[_.summary.ticker];return(0,s.jsxs)("div",{className:(0,k.cn)("flex gap-3 px-1 @sm:ps-5 @sm:pe-0 h-10 items-center"),children:[O?(0,s.jsx)("img",{src:O,alt:_.summary.ticker,className:"w-5 h-5 rounded-sm"}):(0,s.jsx)("div",{className:"flex items-center justify-center w-8 h-8",children:(0,s.jsx)(m.ntg,{className:"w-5 h-5 text-fg-secondary"})}),(0,s.jsxs)("div",{className:"flex-1  gap-1",children:[(0,s.jsx)("span",{className:"text-fg-primary",children:_.summary.ticker})," \xb7"," ",(0,s.jsx)("span",{children:D})," ",(0,s.jsx)("span",{className:"font-semibold",children:function(e,t,a){try{return new Intl.NumberFormat(a,{style:"currency",currency:t,minimumFractionDigits:0,maximumFractionDigits:2}).format(e)}catch(a){return e.toFixed(2)+t}}(P,R,M.language)})," ",(0,s.jsx)(tr.p,{value:A,formatter:e=>e.toFixed(P<1?3:2)})," ",(0,s.jsx)(tr.p,{value:T,formatter:e=>"".concat(e.toFixed(2),"%"),prefix:"(",suffix:")"})]})]})}let td=(e,t)=>{var a,s;let i="",n=0;for(;n<e.length&&(null==(a=e[n])?void 0:a.toLowerCase())===(null==t||null==(s=t[n])?void 0:s.toLowerCase());)i+=e[n],n++;return i},tc=e=>{let{suggestion:t,search:a,className:i}=e,n=t.text.split(" ").map(e=>({text:e,isHighlighted:!1})),r=a.split(" ");return n=n.map((e,t)=>{if(t>=r.length||!r[t])return e;let a=r[t].toLowerCase()===e.text.toLowerCase();return{...e,isHighlighted:a}}),(0,s.jsx)("div",{className:i,children:n.map((e,t)=>{if(t===r.length-1&&r[t]&&e.text.toLowerCase().includes(r[t])){var a;let i=td(e.text,r[t]);return(0,s.jsxs)(y.Fragment,{children:[(0,s.jsx)("span",{className:"font-medium text-primary",children:i}),(0,s.jsxs)("span",{className:"text-muted-foreground",children:[null==(a=e.text)?void 0:a.slice(null==i?void 0:i.length),"\xa0"]})]},t)}return e.isHighlighted?(0,s.jsxs)("span",{className:"font-medium text-primary",children:[e.text,"\xa0"]},t):(0,s.jsxs)("span",{className:"text-muted-foreground",children:[e.text,"\xa0"]},t)})})};var tu=a(19841);let tm=e=>{let{suggestions:t,position:a,onPositionChange:i,onPositionSelect:n,highlightText:r,keyboardNavigationEnabled:l=!0,incrementSuggestionsShownCount:o}=e;return(0,y.useEffect)(()=>{let e=null==t?void 0:t.length;if(!e||!l)return;let s=t=>{if("Enter"===t.key&&!t.shiftKey&&void 0!==a){t.preventDefault(),t.stopPropagation(),n(a);return}let s=0;"ArrowDown"===t.key&&(t.preventDefault(),void 0!==a&&(s=(a+1)%e),a===e-1&&(s=void 0)),"ArrowUp"===t.key&&(t.preventDefault(),void 0!==a&&(s=(a-1)%e),0===a&&(s=void 0),void 0===a&&(s=e-1)),("ArrowUp"===t.key||"ArrowDown"===t.key)&&i(s)};return document.addEventListener("keydown",s,{capture:!0}),()=>document.removeEventListener("keydown",s,{capture:!0})},[a,i,t,n,l]),(0,s.jsx)("ul",{className:"@sm:-mt-1.5 pb-2 flex flex-col overflow-hidden bg-background min-h-36",onMouseLeave:()=>{i(void 0)},children:t.map((e,t)=>(0,s.jsx)("li",{dir:"auto",className:(0,k.cn)("cursor-pointer rounded-xl",a===t?"sm:border-input-border-focus sm:bg-button-ghost-hover":""),onMouseMove:()=>{t!==a&&i(t)},onMouseDown:e=>{e.preventDefault(),e.stopPropagation()},onClick:()=>{n(t)},children:(0,s.jsx)(tp,{suggestion:e,highlightText:r,onReady:o})},JSON.stringify(e)))})};function tp(e){let{suggestion:t,highlightText:a,onReady:i}=e;return((0,y.useEffect)(()=>{null==i||i()},[i]),"stock"===t.type)?(0,s.jsx)(to,{suggestion:t}):"project"===t.type?(0,s.jsx)(tx,{icon:(0,s.jsx)(tn.Oh,{icon:t.project.icon,className:"h-5 w-5 "}),mobileIcon:!0,children:(0,s.jsx)("div",{className:"truncate",children:t.project.name})}):"conversation"===t.type?(0,s.jsx)(tx,{icon:(0,s.jsx)(m.MYu,{className:"h-5 w-5"}),children:(0,s.jsxs)("div",{className:"truncate",children:[(0,s.jsx)("span",{children:t.conversation.title}),(0,s.jsx)(tu.D,{conversation:t.conversation,className:"ms-1.5 text-fg-tertiary hidden @sm:block align-baseline"})]})}):"math"===t.type?(0,s.jsx)(tx,{icon:(0,s.jsx)(m.tEU,{className:"h-5 w-5"}),children:(0,s.jsx)("div",{className:"truncate",children:t.result})}):"answer"===t.type?(0,s.jsx)(tx,{icon:(0,s.jsx)(m.Fl4,{className:"h-5 w-5"}),children:(0,s.jsx)("div",{className:"truncate text-fg-primary",children:t.text})}):(0,s.jsx)(tx,{icon:(0,s.jsx)(ti.A,{className:"h-5 w-5"}),children:(0,s.jsx)(tc,{className:"flex-1",suggestion:t,search:a})})}function tg(e){let{children:t}=e;return(0,s.jsx)("div",{className:"flex gap-3 px-1 @sm:ps-5 @sm:pe-0 h-10 items-center",style:{maskImage:"linear-gradient(to right, rgba(0,0,0,1) 90%, rgba(0,0,0,0) 97%)"},children:t})}function tx(e){let{icon:t,children:a,mobileIcon:i}=e;return(0,s.jsxs)(tg,{children:[(0,s.jsx)("div",{className:(0,k.cn)(i?"block":"hidden","@sm:block justify-start text-fg-secondary shrink-0 grow-0"),children:t}),(0,s.jsx)("div",{className:"flex-auto min-w-0 overflow-hidden truncate",children:a})]})}var th=a(44600);function tv(e){let{className:t,handleSend:a,position:i,setPosition:n,incrementSuggestionsShownCount:r=()=>{},focusTextArea:l=()=>{},disablePills:d=!1}=e,c=(0,_.h)(),{push:u}=(0,eE.wK)(),{t:m}=(0,j.Bd)("chat"),p=(0,o.aP)(U.A("setProjectId")),g=(0,o.aP)(U.A("conversationId"))||"no_conversation_id",x=(0,o.aP)(e=>e.queryByConversationId[g])||"",h=(0,y.useCallback)(e=>{let{idsetQueryByConversationId:t}=o.aP.getState();t(e,g)},[g]),v=(0,A._)(),[f,w]=(0,y.useState)(x),I=(0,th.Pt)(f),N=(0,y.useRef)(""),S=e=>{N.current=e,h(e)};(0,y.useEffect)(()=>{x||n(void 0),(N.current!==x||""===x)&&w(x)},[n,x]);let C=!!x,E=!d&&(!C||!(null==I?void 0:I.length)),M=function(){var e;let t=null==(e=(0,_.h)().EXTRA_SUGGESTIONS.value)?void 0:e.extraSuggestions;return(0,y.useMemo)(()=>{if(t)return[...Array.isArray(t)?t.map(e=>eJ.safeParse(e)).filter(e=>e.success).map(e=>e.data):[],...e0];return e0},[t])}(),P=(0,y.useCallback)(e=>{if(e.prefix){var t;let a="".concat(null==(t=e.prefix)?void 0:t.trim()).concat(x?":":"");(null==x?void 0:x.includes(a))||(h("".concat(a," ").concat(x)),null==l||l())}else e.prompt&&a({query:e.prompt,toolOverrides:{webSearch:!0,xSearch:!0,xMediaSearch:!0,trendsSearch:!0,xPostAnalyze:!0},isPreset:!!c.SUGGESTIONS_USE_CACHE});v("click_suggestion_pill",e.label,{suggestionType:e.type,suggestionPrefix:String(e.prefix),suggestionPrompt:String(e.prompt),location:"chat-autocomplete-suggestions:handleClickTile"})},[h,x,a,c.SUGGESTIONS_USE_CACHE,v,l]),T=!x.includes("\n")&&x.length<75;return(0,s.jsx)(b.P.div,{variants:{hidden:{opacity:0,scale:.9},visible:{opacity:1,scale:1}},initial:"hidden",animate:"visible",exit:"hidden",className:"w-full flex justify-center",children:(0,s.jsxs)("div",{className:(0,k.cn)("z-10 w-full @xl:w-4/5 overflow-x-auto no-touch-scrollbar will-change-[mask-image] @sm:[mask-image:none] min-h-10",eB.Q,t),children:[(0,s.jsx)("div",{className:(0,k.cn)("absolute","bg-background w-full",eB.Q,"transition-opacity",I&&0!==I.length?"opacity-100":"opacity-0 pointer-events-none"),children:(0,s.jsx)(tm,{suggestions:I,position:i,onPositionChange:e=>{if(n(e),void 0===e)S(f);else{let a=I[e];if(((null==a?void 0:a.type)==="search"||(null==a?void 0:a.type)==="llm")&&S(a.text),(null==a?void 0:a.type)==="stock"){var t;S(null!=(t=a.summary.ticker)?t:"")}(null==a?void 0:a.type)==="math"&&S(a.result.toString())}},onPositionSelect:e=>{let t=I[e];if(t){if(v("suggestion_selected",void 0,{suggestionType:t.type,position:String(i),location:"chat-autocomplete-suggestions",searchText:f,text:"llm"===t.type||"search"===t.type||"answer"===t.type?t.text:""}),"search"===t.type||"llm"===t.type?a({query:t.text,toolOverrides:{webSearch:!0,xSearch:!0,xMediaSearch:!0,trendsSearch:!0,xPostAnalyze:!0}}):"answer"===t.type&&a({query:m("validate-answer-message",'{{query}}\n\nHot take: "{{answer}}"\n\nExplain more',{query:f,answer:t.text}),toolOverrides:{webSearch:!0,xSearch:!0,xMediaSearch:!0,trendsSearch:!0,xPostAnalyze:!0}}),(null==t?void 0:t.type)==="stock"){var s;a({query:null!=(s=t.summary.ticker)?s:"",toolOverrides:{webSearch:!0,xSearch:!0,xMediaSearch:!0,trendsSearch:!0,xPostAnalyze:!0}})}(null==t?void 0:t.type)==="project"&&p(t.project.workspaceId),(null==t?void 0:t.type)==="conversation"&&u({page:"chat",conversationId:t.conversation.conversationId,temporary:!1}),(null==t?void 0:t.type)==="math"?(S(t.result.toString()),w(t.result.toString())):(S(""),w("")),n(void 0)}},highlightText:f,keyboardNavigationEnabled:T,incrementSuggestionsShownCount:r})}),E&&(0,s.jsx)(te,{suggestions:M,onClick:P,handleSend:a})]})},"suggestions")}var tf=a(27636);let tb=e=>{let{onHide:t}=e,a=(0,A._)(),i=(0,H.Di)(),{t:n}=(0,j.Bd)("tasks"),{taskPresets:r}=(0,tf.hB)(),l=(0,eW.d)(U.A("setCreateDialogIsOpen")),o=(0,eW.d)(U.A("setTaskToEdit")),[d,c]=(0,y.useState)(tj(r)[0]),u=(0,y.useCallback)(()=>{a("task_preset_clicked",void 0,{location:"PresetTaskPill"}),l(!0),o(d)},[d,l,o,a]),g=(0,y.useCallback)(e=>{a("task_preset_clicked",void 0,{location:"PresetTaskPill"}),l(!0),o(e),c(e)},[l,o,a]);return d?(0,s.jsxs)("div",{className:"flex items-center gap-2 w-full justify-center",children:[(0,s.jsxs)("div",{className:(0,k.cn)("rounded-3xl p-3 bg-surface-l1 border text-xs flex items-center justify-between",{"min-w-[500px]":!i}),children:[(0,s.jsx)(ty,{value:d,onValueChange:g}),(0,s.jsxs)(p.$n,{variant:"filledSecondary",size:"sm",rounded:!0,onClick:u,className:"font-semibold",children:[(0,s.jsx)(m.mdw,{size:14}),i?n("create-custom-task-dialog.schedule-task-short","Schedule"):n("create-custom-task-dialog.schedule-task","Schedule Task")]})]}),(0,s.jsx)(p.gx,{tooltipContent:(0,s.jsx)("p",{children:n("create-custom-task-dialog.schedule-task-hide","Hide")}),tooltipContentProps:{side:"bottom"},variant:"filledSecondary",size:"iconMd",rounded:!0,"aria-label":n("create-custom-task-dialog.schedule-task-hide","Hide"),onClick:t,children:(0,s.jsx)(m.X,{size:14})})]}):null};function ty(e){let{value:t,onValueChange:a}=e,[i,n]=(0,y.useState)(!1),{taskPresets:r}=(0,tf.hB)(),{t:l}=(0,j.Bd)("tasks"),o=(0,H.Di)(),d=(0,y.useCallback)(e=>{n(e)},[]);return(0,s.jsxs)(V.rI,{open:i,onOpenChange:d,children:[(0,s.jsx)(V.ty,{asChild:!0,children:(0,s.jsxs)(p.$n,{className:"flex items-center font-semibold",variant:"text","aria-label":l("selected-day.label","Selected day"),size:"sm",children:[t.cta||t.name,(0,s.jsx)(m.yQN,{size:14,className:(0,k.cn)("transition-transform duration-200",{"rotate-180":i})})]})}),(0,s.jsx)(V.SQ,{side:"bottom",align:"start",sideOffset:20,alignOffset:-12,className:(0,k.cn)({"w-[500px]":!o}),children:tj(r).map(e=>(0,s.jsxs)(V._2,{onSelect:()=>{a(e)},className:"group flex items-center justify-between gap-2",children:[e.name,(0,s.jsx)(m.c_$,{size:14,className:"opacity-0 group-hover:opacity-100"})]},e.name))})]})}function tj(e){for(let t=e.length-1;t>0;t--){let a=Math.floor(Math.random()*(t+1));[e[t],e[a]]=[e[a],e[t]]}return e}let tw=()=>(0,s.jsx)(s.Fragment,{});var tI=a(66570),tN=a(59109),tk=a(56907),tS=a(95158),tC=a(94553),tE=a(85666),t_=a(50626),tM=a(80832),tP=a(97533),tA=function(e){return e.PAST_30_DAYS="past-30-days",e.THIS_MONTH="this-month",e.THIS_YEAR="this-year",e.PAST_3_MONTHS="past-3-months",e.PAST_6_MONTHS="past-6-months",e}({});let tT=e=>{let{isError:t,title:a,timeRangeOptions:i,selectedTimeRange:n,onTimeRangeChange:r,children:l}=e,{t:o}=(0,j.Bd)("base"),[d,c]=(0,y.useState)(!1),u=(0,y.useCallback)(e=>o("team-insights.time-range.".concat(e),e),[o]),p=(0,y.useMemo)(()=>u(n),[n,u]);return(0,s.jsxs)("div",{className:"h-full flex flex-col",children:[(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-xs text-fg-secondary",children:a}),(null==i?void 0:i.length)?(0,s.jsxs)(V.rI,{open:d,onOpenChange:c,children:[(0,s.jsxs)(V.ty,{className:"text-xs text-fg-tertiary flex items-center gap-1 focus:outline-none",children:[(0,s.jsx)("span",{className:"whitespace-nowrap",children:p}),(0,s.jsx)(m.D3D,{className:(0,k.cn)("size-3 text-fg-tertiary transition-transform",{"rotate-180":d})})]}),(0,s.jsx)(V.SQ,{sideOffset:8,align:"end",className:"min-w-40",children:i.map(e=>(0,s.jsxs)(V._2,{onSelect:()=>null==r?void 0:r(e),className:"flex items-center gap-2 justify-between",children:[(0,s.jsx)("span",{children:u(e)}),e===n&&(0,s.jsx)(m.Srz,{className:"text-fg-primary size-4"})]},e))})]}):(0,s.jsx)("span",{className:"text-xs text-fg-tertiary",children:p})]}),(0,s.jsx)("div",{className:"flex flex-col justify-between mt-3 w-full h-12",children:t?(0,s.jsx)(b.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"flex justify-center items-center h-full border border-border-l1 rounded-2xl",children:(0,s.jsx)("span",{className:"text-fg-tertiary text-sm",children:o("team-insights.error-loading-data","Could not load data")})},"error"):l})]})},tR=e=>{switch(e){case"past-30-days":return(0,tC.e)((0,tE.R)(),29).toISOString();case"this-month":return(0,t_.w)((0,tE.R)()).toISOString();case"this-year":return(0,tM.D)((0,tE.R)()).toISOString();case"past-3-months":return(0,t_.w)((0,tP.a)((0,tE.R)(),2)).toISOString();case"past-6-months":return(0,t_.w)((0,tP.a)((0,tE.R)(),5)).toISOString()}};var tD=a(48589);let tO=()=>{let{t:e}=(0,j.Bd)("base"),{currentTeam:t,isSwitchingTeam:a}=(0,eU.hd)(),[i,n]=(0,P.M)("team-insights.messages-counters-time-range",tA.THIS_MONTH),r=(0,y.useMemo)(()=>tR(i),[i]),{data:l,isFetching:o,isError:d}=(0,tk.IT)({queryKey:["team-stats",null==t?void 0:t.teamId,r],queryFn:async()=>tS.xT.grokForTeamsGetTeamStats({fromTime:r,maxEntries:3}),enabled:!!(null==t?void 0:t.teamId)&&!a,staleTime:1/0}),c=(0,y.useMemo)(()=>o||a,[o,a]),u=(0,tD.o)(c,300,[c]),m=(0,y.useMemo)(()=>[{count:parseInt(u?"0":(null==l?void 0:l.messageCount)||"0"),label:e("team-insights.you","You")},{count:parseInt(u?"0":(null==l?void 0:l.totalMessages)||"0"),label:e("team-insights.team","Team")}],[l,e,u]);return(0,s.jsx)(tT,{title:e("team-insights.messages","Messages"),timeRangeOptions:[tA.THIS_MONTH,tA.PAST_3_MONTHS,tA.PAST_6_MONTHS,tA.THIS_YEAR],selectedTimeRange:i,onTimeRangeChange:e=>n(e),isError:d,children:m.map((e,t)=>(0,s.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,s.jsx)("span",{className:"text-xs text-fg-secondary",children:e.label}),(0,s.jsx)(f.N,{mode:"wait",initial:!1,children:c?(0,s.jsx)(b.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"h-6 flex items-center justify-end",children:(0,s.jsx)(ev.E,{className:(0,k.cn)("h-2 w-10 rounded-sm",{"w-20":1===t})})},"loading"):(0,s.jsx)(b.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.2},className:"h-6",children:(0,s.jsx)(tN.Ay,{value:e.count,className:"text-sm font-semibold"})},"count")})]},e.label))})},tz=()=>{let{t:e}=(0,j.Bd)("base"),{currentTeam:t,isSwitchingTeam:a}=(0,eU.hd)(),[i,n]=(0,P.M)("team-insights.sharing-leaderboard-time-range",tA.THIS_MONTH),r=(0,y.useMemo)(()=>tR(i),[i]),{data:l,isFetching:o,isError:d}=(0,tk.IT)({queryKey:["team-stats",null==t?void 0:t.teamId,r],queryFn:async()=>tS.xT.grokForTeamsGetTeamStats({fromTime:r,maxEntries:3}),enabled:!!(null==t?void 0:t.teamId)&&!a,staleTime:1/0}),c=(0,y.useMemo)(()=>o||a,[o,a]),u=(0,y.useMemo)(()=>{var e,t;let a=Array.from({length:3}).map(()=>({name:" - ",shareLinkCount:0}));return[...(null==l||null==(t=l.topUsers)||null==(e=t.map(e=>{var t,a;return{name:"".concat(null==(t=e.user)?void 0:t.givenName," ").concat(null==(a=e.user)?void 0:a.familyName),shareLinkCount:parseInt(e.shareLinkCount||"0")}}))?void 0:e.sort((e,t)=>t.shareLinkCount-e.shareLinkCount))||[],...a].slice(0,3)},[l]);return(0,s.jsx)(tT,{title:e("team-insights.top-sharers","Top sharers"),timeRangeOptions:[tA.THIS_MONTH,tA.PAST_3_MONTHS,tA.PAST_6_MONTHS,tA.THIS_YEAR],selectedTimeRange:i,onTimeRangeChange:e=>n(e),isError:d,children:u.map((t,a)=>{let{name:i,shareLinkCount:n}=t;return(0,s.jsxs)("div",{className:"flex items-center justify-between gap-3 w-full h-4",children:[(0,s.jsxs)("div",{className:"flex items-center gap-1 min-w-0",children:[(0,s.jsx)("span",{className:"text-fg-secondary text-[12px] w-3 text-start",children:a+1}),(0,s.jsx)(f.N,{initial:!1,mode:"wait",children:c?(0,s.jsx)(b.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:(0,s.jsx)(ev.E,{className:"h-2 w-20 rounded-sm"})},"loading"):(0,s.jsx)(b.P.span,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"text-fg-primary text-xs truncate",children:i},"name")})]}),(0,s.jsx)(f.N,{initial:!1,mode:"wait",children:c?(0,s.jsx)(b.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:(0,s.jsx)(ev.E,{className:"h-2 w-20 rounded-sm"})},"loading"):(0,s.jsx)(b.P.span,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"text-xs text-fg-tertiary whitespace-nowrap",children:e("team-insights.share-count","{{count}} shared",{count:n})},"count")})]},"".concat(a,"-").concat(i))})})};var tU=a(61884),tL=a(16506),tB=a(14100),tK=a(73755),tH=function(e){return e[e.NONE=0]="NONE",e[e.LOW=1]="LOW",e[e.MEDIUM=2]="MEDIUM",e[e.HIGH=3]="HIGH",e[e.VERY_HIGH=4]="VERY_HIGH",e}(tH||{});let tq=()=>{let{t:e}=(0,j.Bd)("base"),{resolvedTheme:t}=(0,tL.D)(),{currentTeam:a,isSwitchingTeam:i}=(0,eU.hd)(),n=(0,y.useMemo)(()=>tR(tA.PAST_30_DAYS),[]),{data:r,isLoading:l,isError:o}=(0,tk.IT)({queryKey:["team-stats",null==a?void 0:a.teamId,n],queryFn:async()=>tS.xT.grokForTeamsGetTeamStats({fromTime:n,maxEntries:3}),enabled:!!(null==a?void 0:a.teamId)&&!i,staleTime:1/0}),d=(0,y.useMemo)(()=>{let e=Array.from({length:30}).map((e,t)=>{var a,s,i;let l=new Date(n);return l.setDate(l.getDate()+t),parseInt((null==r||null==(i=r.teamStats)||null==(s=i.stats)||null==(a=s.find(e=>e.startTime&&(0,tB.r)(e.startTime,l)))?void 0:a.totalMessages)||"0")}),t=e.filter(e=>e>0),a=[0,1,20,50];if(t.length>0){let e=[...t].sort((e,t)=>e-t),s=e[Math.floor(.25*e.length)]||1;a=[0,s,e[Math.floor(.5*e.length)]||1,e[Math.floor(.75*e.length)]||1]}return Array.from({length:30}).map((t,s)=>{let i=new Date(n);i.setDate(i.getDate()+s);let r=e[s]||0,l=0===r?0:r<=a[1]?1:r<=a[2]?2:r<=a[3]?3:4;return{date:i.toISOString(),totalMessages:r,colorLevel:l}})},[n,r]),c=(0,y.useMemo)(()=>l||i,[l,i]);return(0,s.jsx)(tT,{title:e("team-insights.team-usage","Team usage"),selectedTimeRange:tA.PAST_30_DAYS,isError:o,children:(0,s.jsx)("div",{className:"grid grid-cols-12 content-between w-full h-full max-w-[260px] place-items-stretch",children:d.map((a,i)=>(0,s.jsxs)(tU.m_,{disableHoverableContent:!0,delayDuration:0,children:[(0,s.jsx)(tU.k$,{asChild:!0,children:(0,s.jsx)("div",{className:(0,k.cn)("group w-full h-full flex items-center justify-center",{"cursor-pointer":!c}),children:(0,s.jsx)("div",{className:(0,k.cn)("duration-200 transition-all",{"group-hover:scale-125":!c}),children:(0,s.jsx)("div",{className:(0,k.cn)("w-3 h-3 border border-border-l1 rounded-[4px] transition-all duration-500",{"animate-pulse":c}),style:{backgroundColor:tF[t||"dark"][c?0:a.colorLevel],animationDelay:"".concat(.03*i,"s"),animationDuration:"1s"}})})})}),!c&&(0,s.jsx)(tU.ZI,{children:(0,s.jsx)("span",{className:"text-xs",children:a.totalMessages?e("team-insights.day-with-activity","{{count}} messages on {{date}}",{date:(0,tK.GP)(a.date,"MMMM do"),count:a.totalMessages}):e("team-insights.day-without-activity","No activity on {{date}}",{date:(0,tK.GP)(a.date,"MMMM do")})})})]},a.date))})})},tF={dark:{0:"#1D1E20",1:"#242628",2:"#3E3F41",3:"#57595B",4:"#B5B5B5"},light:{0:"#F3F3F1",1:"#BFBEBD",2:"#9F9E9D",3:"#646362",4:"#4B4A48"}};var tG=a(25901);let tW=e=>{let{className:t}=e;return(0,s.jsx)(tG.x,{transition:{duration:.2,ease:"easeInOut"},children:(0,s.jsx)("div",{className:(0,k.cn)("@container/team-insights w-full",t),children:(0,s.jsxs)("div",{className:"grid grid-cols-1 @[500px]/team-insights:grid-cols-2 @[700px]/team-insights:grid-cols-3 w-full",children:[(0,s.jsx)("div",{className:"hidden @[500px]/team-insights:block pl-4 pr-6",children:(0,s.jsx)(tq,{})}),(0,s.jsxs)("div",{className:"hidden @[700px]/team-insights:block px-6 relative",children:[(0,s.jsx)(tO,{}),(0,s.jsx)("div",{className:"hidden @[500px]/team-insights:block absolute left-0 inset-y-1 border-l border-border-l1"})]}),(0,s.jsxs)("div",{className:"pr-4 pl-6 relative",children:[(0,s.jsx)(tz,{}),(0,s.jsx)("div",{className:"hidden @[500px]/team-insights:block absolute left-0 inset-y-1 border-l border-border-l1"})]})]})})})};var tV=a(68217);let t$=e=>{let{className:t}=e,{t:a}=(0,j.Bd)("base"),{isSwitchingTeam:i}=(0,eU.hd)(),{results:n,isFetching:r,isError:l,isLoadingTeamMembers:o,handleNavigateToSharedConversation:d}=(0,tV.K)({pageSize:60,orderBy:"viewCount"}),c=(0,y.useMemo)(()=>r||i,[r,i]);return(0,s.jsx)(tG.x,{transition:{duration:.2,ease:"easeInOut"},children:(0,s.jsxs)("div",{className:(0,k.cn)("@container/shared-with-me w-full",t),children:[(0,s.jsxs)("div",{className:"px-4 flex justify-between items-center gap-3",children:[(0,s.jsx)("span",{className:"text-xs text-fg-secondary",children:a("team-insights.shared-with-me","Shared with me")}),(0,s.jsx)(eE.N_,{route:{page:"history",tab:"shared-with-me"},className:"text-xs text-fg-tertiary hover:text-fg-secondary transition-all",children:a("team-insights.see-all","See all")})]}),l?(0,s.jsx)(b.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"flex justify-center items-center mx-4 py-6 mt-4 border border-border-l1 rounded-2xl",children:(0,s.jsx)("span",{className:"text-fg-tertiary text-sm",children:a("team-insights.error-loading-data","Could not load data")})},"error"):(0,s.jsx)("div",{className:"px-4 mt-4 grid grid-cols-1 @[500px]/shared-with-me:grid-cols-3 w-full gap-4",children:(0,s.jsx)(f.N,{initial:!1,children:Array.from({length:3}).map((e,t)=>{let a=n[t];return(0,s.jsx)(tY,{shareLink:a,isLoading:c,isLoadingTeamMembers:o,onClick:a?()=>d(a.shareLinkId):void 0},"shared-with-me-".concat(t))})})})]})})},tY=e=>{var t,a,i;let{shareLink:n,isLoading:r,isLoadingTeamMembers:l,onClick:o}=e,d=(0,y.useMemo)(()=>!r&&!n,[r,n]);return(0,s.jsxs)(b.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:o,className:(0,k.cn)("p-3 flex flex-col gap-2 bg-surface-l1 border border-border-l1 rounded-2xl transition-colors relative",{"cursor-pointer hover:bg-surface-l2":!!n&&!r,"bg-transparent":d}),children:[(0,s.jsx)("div",{className:"h-5 flex items-center min-w-0",children:(0,s.jsx)(f.N,{mode:"wait",initial:!1,children:r?(0,s.jsx)(b.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:(0,s.jsx)(ev.E,{className:"h-2 w-20 rounded-sm"})},"loading"):n&&(0,s.jsx)(b.P.span,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"text-sm text-fg-primary truncate",children:(null==(t=n.conversation)?void 0:t.title)||"Untitled Conversation"},"title")})}),(0,s.jsx)("div",{className:"h-4 flex items-center min-w-0 ",children:(0,s.jsx)(f.N,{mode:"wait",initial:!1,children:r||l?(0,s.jsx)(b.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:(0,s.jsx)(ev.E,{className:"h-2 w-16 rounded-sm"})},"loading-user"):n&&(0,s.jsx)(b.P.span,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"text-fg-secondary text-xs truncate",children:"".concat((null==n||null==(a=n.user)?void 0:a.givenName)||""," ").concat((null==n||null==(i=n.user)?void 0:i.familyName)||"")},"user")})}),(0,s.jsx)(f.N,{initial:!1,children:d&&(0,s.jsx)(b.P.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:(0,k.cn)("absolute inset-0 flex justify-center items-center"),children:(0,s.jsx)("div",{className:"w-10 border-b border-border-l1"})},"empty-state")})]})};var tQ=a(91102);let tX=0;function tJ(){let{user:e}=(0,ei.useSession)(),{os:t}=(0,tQ.c)(),a=(0,e_.useRouter)(),i=(0,A._)(),n=(0,H.Di)(),{push:r}=(0,eE.wK)(),[l,o]=(0,P.M)("visited-imagine",!1),[d,c]=(0,P.M)("imagine-banner-impressions",0);(0,y.useEffect)(()=>{Date.now()<tX||(tX=Date.now()+12e4,c(e=>e+1))},[]);let{resolvedTheme:u}=(0,tL.D)(),p=(0,y.useCallback)(e=>{e.stopPropagation(),i("imagine_banner_clicked","imagine-banner",{location:"imagine-banner"}),r({page:"imagine"})},[r,i]),g=(0,y.useCallback)(e=>{e.stopPropagation(),o(!0),i("imagine_banner_dismissed","imagine-banner",{location:"imagine-banner"})},[o,i]);(0,y.useEffect)(()=>{i("imagine_banner_impression","imagine-banner",{location:"imagine-banner"})},[]);let x=(0,y.useCallback)(e=>{e.stopPropagation(),i("imagine_banner_clicked","imagine-banner",{location:"imagine-banner"});let s=new URLSearchParams({return_to:"/imagine"}).toString();i("sign_up_redirect",t,{location:"imagine-banner",os:t}),a.push("/sign-up".concat(s?"?".concat(s):""))},[i,t,a]),h=(0,y.useCallback)(e=>{e.stopPropagation(),i("imagine_banner_clicked","imagine-banner",{location:"imagine-banner"});let s=new URLSearchParams({return_to:"/imagine"}).toString();i("sign_in_redirect",t,{location:"imagine-banner",os:t}),a.push("/sign-in".concat(s?"?".concat(s):""))},[i,t,a]),{t:v}=(0,j.Bd)("imagine");return(0,s.jsxs)("div",{className:(0,k.cn)("relative dark max-w-[480px] w-full m-10",{"m-0 mb-24 mx-2":n}),children:[(0,s.jsxs)("div",{className:(0,k.cn)("flex dark flex-col items-center justify-center w-full rounded-3xl overflow-hidden  cursor-pointer bg-surface-l1 ",{"border-2 border-color-surface-l1":"dark"===u}),onClick:p,children:[(0,s.jsx)("div",{className:"relative w-full h-[88px] overflow-hidden",children:(0,s.jsx)(q.default,{src:"/imagine-banner.png",alt:"",fill:!0,className:"object-cover"})}),(0,s.jsxs)("div",{className:"flex flex-row items-center justify-between px-4 pt-0 pb-3 w-full",children:[(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)("p",{className:"dark text-primary text-sm font-bold m-0 p-0",children:v("imagine.banner.title","Imagine Anything")}),(0,s.jsx)("p",{className:"dark text-fg-secondary text-sm m-0 p-0 single line-clamp-1 break-all",children:v("imagine.banner.subtitle","Generate images and videos with Grok Imagine.")})]}),e&&(0,s.jsx)(e2.$n,{variant:"secondary",shape:"pill",size:"md",className:"dark font-bold text-primary",onClick:p,children:v("imagine.banner.button","Go")})]}),!e&&(0,s.jsxs)("div",{className:"flex flex-row gap-4 items-start justify-start mb-3",children:[(0,s.jsxs)(e2.$n,{className:"font-semibold text-sm",variant:"primary",size:"sm",shape:"pill",onClick:x,children:[(0,s.jsx)(m.KJW,{size:14}),v("Sign up","Sign up")]}),(0,s.jsx)(e2.$n,{className:"font-semibold text-sm",variant:"secondary",size:"sm",shape:"pill",onClick:h,children:v("Sign in","Sign in")})]})]}),(0,s.jsx)(e2.$n,{variant:"tertiary",shape:"circle",size:"xs",className:"dark font-bold text-primary absolute -top-2 -end-2 bg-surface-l2 hover:bg-surface-l4",onClick:g,"aria-label":"Close",children:(0,s.jsx)(m.uv5,{className:"size-4"})})]})}function tZ(){let{t:e}=(0,j.Bd)("chat"),{isSuperGrokUser:t,isEnterpriseUser:a,isSuperGrokProUser:i,bestSubscription:n,isPending:r}=(0,eD.Q2)(),l=(0,eW.d)(U.A("userActiveTasks")),d=(0,eW.d)(U.A("initialized")),c=(0,y.useRef)(""),{signInWithReturnTo:u}=(0,el.o)(),p=(0,A._)(),g=(0,_.h)(),{handleVoiceModeEnter:h}=(0,eN.F)({location:"chat-new"}),w=(0,o.aP)(U.A("establishNewConversation")),I=(0,z.C$)(U.A("isIncognito")),N=(0,o.aP)(U.A("activeModelId")),S=(0,o.aP)(U.A("defaultAnonModelId")),C=(0,o.aP)(U.A("defaultFreeModelId")),M=(0,o.aP)(U.A("defaultProModelId")),T=(0,o.aP)(U.A("setDefaultAnonModelId")),O=(0,o.aP)(U.A("setDefaultFreeModelId")),L=(0,o.aP)(U.A("setDefaultProModelId")),B=(0,o.aP)(U.A("outputMode")),K=(0,o.aP)(U.A("reasoningMode")),q=(0,o.aP)(U.A("setReasoningMode")),F=(0,o.aP)(U.A("conversationId")),G=(0,o.aP)(U.A("conversationId"))||"no_conversation_id",W=(0,o.aP)(e=>e.queryByConversationId[G])||"",V=(0,x.c)(),[$]=(0,P.M)("visited-imagine",!1),[Y]=(0,P.M)("imagine-banner-impressions",0),Q=!V&&g.SHOW_IMAGINE_BANNER&&Y<=10&&!$&&0===W.length,{sessionStartTime:X,conversationDepth:J}=(0,eF.T)(F),Z=(0,H.Di)(),ee=(0,R.x)(U.A("listByConversationId")),et=(0,R.x)(U.A("attachListByConversationId")),ea=(0,D.j)(U.A("isOpen")),es=(0,y.useMemo)(()=>ee.no_conversation_id||[],[ee]),en=(0,y.useMemo)(()=>et.no_conversation_id||[],[et]),er=(0,eH.$E)(),eo=(0,H.Di)(),ed=(0,eO.n)(),ec=(0,y.useMemo)(()=>ed&&!W&&!I,[ed,W,I]),eu=(0,y.useMemo)(()=>!I&&(es.length>0&&!!es.every(e=>e.file.type.includes("image"))||(null==en?void 0:en.length)>0&&!!en.every(e=>e.mimeType.includes("image"))),[es,en,I]),em=(0,y.useMemo)(()=>!I&&g.SHOW_CREATE_REPORT_BUTTON_ON_ATTACHMENTS&&(es.length>0&&!!es.every(e=>e.metadata&&e.file.type.includes("csv"))||(null==en?void 0:en.length)>0&&!!en.every(e=>e.mimeType.includes("csv"))),[es,en,g.SHOW_CREATE_REPORT_BUTTON_ON_ATTACHMENTS,I]),[ep,eg]=(0,y.useState)(!1);(0,y.useEffect)(()=>{var e;let t=null!=(e=window.localStorage.getItem("hideTaskPillCount"))?e:0;t=Number(t),g.REPLACE_HOME_PILLS_WITH_TASKS&&0===l.length&&t<2&&!ed?eg(!0):eg(!1)},[g.REPLACE_HOME_PILLS_WITH_TASKS,l.length,ed]);let ex=(0,y.useCallback)(()=>{var e;let t=null!=(e=window.localStorage.getItem("hideTaskPillCount"))?e:0;window.localStorage.setItem("hideTaskPillCount",String(Number(t)+1)),eg(!1)},[]),ev=(0,E.L)(),ef=(0,ei.useSession)().user;(0,y.useEffect)(()=>{let e=z.C$.getState();g.NEW_CHAT_ALWAYS_AUTO&&e.userSettings.preferences.useModelModeSelector3&&o.aP.getState().setModelMode("auto")},[]);let eb=(0,y.useRef)(null),ey=(0,y.useCallback)(()=>{var e;null==(e=eb.current)||e.focus()},[eb]);(0,eR.v)(eT.Ib,ey,[]);let{handleKeyDown:ej,consumeCompositionTimeMs:ew,consumeBackspaceCount:eI,consumeAvgKeystrokeLatency:ek,consumeKeystrokeCount:eS,position:eC,setPosition:eE,consumePosition:e_,consumeTypeaheadReqCount:ez,incrementTypeaheadReqCount:eU,incrementSuggestionsShownCount:e$,consumeSuggestionsShownCount:eY}=(0,eK.T)(),eQ=(0,y.useCallback)(e=>{let{query:t,fileAttachmentIds:a,webpageUrls:s,toolOverrides:i,isPreset:r,workspaceIds:l,persona:d,isIncognitoOverride:c,disableMemory:m}=e;if(!t)return Promise.resolve(!1);if(!ef&&(!g.ENABLE_ANON_USERS||er.includes(N)))return p("sign_in","chat-new",{location:"chat-new"}),u(t,K),Promise.resolve(!1);let x=z.C$.getState(),h=e_(),f=i;th.jp.getState().config.enabled&&-1!==h&&void 0!==h&&!i&&(f={webSearch:!0});let b=o.aP.getState(),y=(0,eG.m)({chatPageState:{activeModelId:N,modelMode:b.modelMode,outputMode:B,reasoningMode:K},query:t,fileAttachmentIds:a,webpageUrls:s,location:"chat-new",personalityId:x.userSettings.preferences.selectedSystemPromptId||"",personaId:"",sessionStartTime:X,conversationDepth:J,isMobile:Z,bestSubscription:n,user:!!ef,compositionTime:ew(),backspaceCount:eI(),avgKeystrokeLatency:ek(),keystrokeCount:eS(),position:h,typeaheadRequestCount:ez(),suggestionsShownCount:eY(),workspaceCount:(null==l?void 0:l.length)||0,toolOverrides:f,suggestionsSource:g.ENABLE_LLM_SUGGESTIONS?"grok":"bing"});return p("send_query","",y),ev().then(()=>((0,tI.Lc)(),!!w({message:t,fileAttachmentIds:a,webpageUrls:s,toolOverrides:f,temporary:null!=c?c:I,isPreset:r,persona:d,enableRetries:g.ENABLE_AUTO_STREAM_RETRY,ff:g,workspaceIds:l,disableMemory:m}).catch((0,v.HX)("chat-new:establishNewConversation"))))},[N,ef,g,p,I,B,K,er,ev,w,ek,eI,ew,eS,e_,eY,ez,u,J,Z,X,n]),{modelById:eX,defaultAnonModelId:eJ,defaultFreeModelId:eZ,defaultProModelId:e0,isPending:e1}=(0,eH.GB)(),e2=(0,o.aP)(U.A("setActiveModelId")),e3=(0,o.aP)(U.A("setModelMode"));(0,y.useEffect)(()=>{if(e1||r&&ef)return;let e=new URLSearchParams(location.search),s=e.get("q"),n=e.get("reasoningMode"),l=e.get("fileid"),o=location.hash===eV.oE;if(M!==e0&&(a||t||i)&&e0&&eX[e0]){L(e0),e2(e0);return}if(C!==eZ&&ef&&eZ&&eX[eZ]){O(eZ),e2(eZ);return}if(S!==eJ&&eJ&&eX[eJ]){T(eJ),e2(eJ);return}if(n){let e=eq.TM.parse(n);e&&q(e)}s&&!c.current&&(eQ({query:s,fileAttachmentIds:l?[l]:void 0,webpageUrls:[],isIncognitoOverride:o,disableMemory:!0}).catch(e=>{(0,v.vV)("chat-new:mount:handleSend",e)}),c.current="auto-start")},[e1,r]);let e5=(0,y.useCallback)(t=>{let{query:a,parentQuotedText:s,fileAttachmentIds:i,webpageUrls:n,toolOverrides:r,isPreset:l,persona:o}=t;if(o){let t=(0,eh.pL)(o.personaId,e);t.modelMode&&e3(t.modelMode)}eQ({query:a,parentQuotedText:s,fileAttachmentIds:i,webpageUrls:n,toolOverrides:r,persona:o,isPreset:l}).catch(e=>{(0,v.vV)("chat-new:handleClickSuggestion",e)})},[eQ,e3,e]),e4=(0,y.useCallback)(()=>{let t=[...es.map(e=>e.metadata).filter(e=>e&&!(e instanceof Error)).map(e=>e.fileMetadataId),...en.map(e=>e.assetId)];eQ({query:e("create-report-prompt","Create a report"),fileAttachmentIds:t}).catch(e=>{(0,v.vV)("chat-new:handleClickCreateReport",e)})},[eQ,es,en,e]);return(0,y.useEffect)(()=>{(0,tI.b2)()},[]),(0,s.jsxs)("div",{className:"flex flex-col items-center w-full h-full p-2 mx-auto justify-center @sm:p-4 @sm:gap-9 isolate mt-16 @sm:mt-0 overflow-scroll",children:[g.SHOW_GROK_4_PROMOTION_DIALOG&&(0,s.jsx)(tw,{}),(0,s.jsxs)("div",{className:(0,k.cn)("flex flex-col items-center gap-6 h-[450px] w-full @sm:pt-12 isolate transition-transform",{"-translate-y-20":ed&&!eo}),children:[(0,s.jsxs)("div",{className:(0,k.cn)("flex flex-col items-center justify-center w-full @sm:px-4 px-2 gap-6 @sm:gap-4 @xl:w-4/5 flex-initial pb-0",eB.Q),children:[(0,s.jsx)(eL,{height:64,width:320}),eo&&(0,s.jsx)(f.N,{mode:"wait",initial:!1,children:ec?(0,s.jsx)(b.P.div,{variants:{hidden:{opacity:0},visible:{opacity:1}},initial:"hidden",animate:"visible",transition:{duration:.2},className:(0,k.cn)("w-full",eB.Q),children:(0,s.jsx)(tW,{className:"w-full my-6"})},"teams-ui"):(0,s.jsx)(tv,{className:(0,k.cn)("overflow-visible @sm:invisible",I&&"invisible"),handleSend:e5,position:eC,setPosition:eE,incrementTypeaheadReqCount:eU,incrementSuggestionsShownCount:e$,focusTextArea:ey,disablePills:ed})})]}),(0,s.jsxs)("div",{className:(0,k.cn)("absolute bottom-0 mx-auto inset-x-0",eB.Q,"@sm:relative flex flex-col items-center w-full gap-1 @sm:gap-5 @sm:bottom-auto @sm:inset-x-auto @sm:max-w-full"),children:[(0,s.jsxs)("div",{className:(0,k.cn)("flex flex-col-reverse items-center justify-between flex-1 w-full gap-0 @sm:gap-3 @sm:flex-col relative","p-2 @sm:p-0"),children:[(0,s.jsx)(eP.s,{className:"mt-2",textAreaClassName:"min-h-14 pt-5 my-0 mb-5",placeholder:e("query-bar-placeholder.1","What do you want to know?"),onQuery:eQ,onFrontPage:!ea,ref:eb,isIncognito:I,enableVoiceMode:!0,onKeyDown:ej,onVoiceModeEnter:h},"query-bar"),(0,s.jsxs)(f.N,{mode:"wait",initial:!1,children:[eu&&!I&&(0,s.jsx)(b.P.div,{variants:{hidden:{opacity:0,scale:.9},visible:{opacity:1,scale:1}},initial:"hidden",animate:"visible",exit:"hidden",className:"bg-background rounded-full",children:(0,s.jsxs)(eM.R,{shouldGetFromStore:!0,buttonProps:{variant:"filledSecondary",size:"md",rounded:!0},location:"chat-new-input",children:[(0,s.jsx)(m.mgJ,{className:"size-5 text-secondary"}),e("Edit Image","Edit Image")]})},"edit"),em&&!I&&(0,s.jsx)(b.P.div,{variants:{hidden:{opacity:0,scale:.9},visible:{opacity:1,scale:1}},initial:"hidden",animate:"visible",exit:"hidden",className:"bg-background rounded-full",children:(0,s.jsx)(e7,{suggestion:{type:"createReport",label:e("create-report","Create Report")},onClick:e4})},"edit"),Q?(0,s.jsx)(b.P.div,{variants:{hidden:{opacity:0,scale:.9},visible:{opacity:1,scale:1}},initial:"hidden",animate:"visible",transition:{duration:.1},exit:"hidden",className:(0,k.cn)("w-full flex justify-center",{invisible:I}),children:(0,s.jsx)(tJ,{})},"imagine-banner"):d&&!eo&&(ep?(0,s.jsx)(b.P.div,{variants:{hidden:{opacity:0,scale:.9},visible:{opacity:1,scale:1}},initial:"hidden",animate:"visible",exit:"hidden",className:(0,k.cn)("w-full flex justify-center",{invisible:I}),children:(0,s.jsx)(tb,{onHide:ex})},"task-pill"):!eo&&!eu&&!em&&(ec?(0,s.jsxs)(b.P.div,{variants:{hidden:{opacity:0},visible:{opacity:1}},initial:"hidden",animate:"visible",transition:{duration:.2},className:(0,k.cn)("w-full",eB.Q),children:[(0,s.jsx)(tW,{className:"w-full mt-10"}),(0,s.jsx)(t$,{className:"w-full mt-10 mb-6"})]},"teams-ui"):(0,s.jsx)(tv,{className:(0,k.cn)("hidden @sm:block overflow-visible",I&&"invisible"),handleSend:e5,position:eC,setPosition:eE,incrementTypeaheadReqCount:eU,incrementSuggestionsShownCount:e$,focusTextArea:ey,disablePills:ed||Q})))]})]}),ef?null:(0,s.jsx)("div",{className:"text-[11px] @sm:text-xs text-secondary text-nowrap",children:(0,s.jsx)(j.x6,{ns:"chat",i18nKey:"clickwrapAgreement",defaults:"By messaging Grok, you agree to our <terms>Terms</terms> and <policy>Privacy Policy</policy>.",components:{terms:(0,s.jsx)("a",{className:"text-primary",href:"https://x.ai/legal/terms-of-service",target:"_blank",rel:"noopener noreferrer"}),policy:(0,s.jsx)("a",{className:"text-primary",href:"https://x.ai/legal/privacy-policy",target:"_blank",rel:"noopener noreferrer"})}})})]})]}),(0,s.jsx)(eA.tN,{})]})}var t0=a(48992),t1=a(36401);function t2(e){let{conversationIsLoading:t,conversationError:a,optimisticConversationId:i,conversationId:n,conversation:r}=e,l=(0,Q.K)(),d=(0,o.aP)(U.A("conversationMode"));return((0,y.useEffect)(()=>{(null==r?void 0:r.conversationId)&&O.A3.getState().loadInitialResponses(r.conversationId).then(e=>{var t;let a=o.aP.getState();if(a.conversationId===(null==(t=e[0])?void 0:t.conversationId)){let t=(0,t0.Mb)(e);if(!t)return void a.setLastMessageId(void 0);if("streaming"===t.state||"reconnecting"===t.state){a.setLastMessageId(t.parentResponseId),a.setStreamedMessageId(t.responseId);return}if("optimistic"===t.state){a.setLastMessageId(t.parentResponseId),a.setOptimisticMessageId(t.responseId);return}a.setLastMessageId(t.responseId)}}).catch(e=>{l("chat-page:loadInitialResponses",e)})},[null==r?void 0:r.conversationId]),i)?(0,s.jsx)(t1.T,{conversationId:i,conversation:void 0,isOptimisticConversation:!0,conversationIsLoading:t,conversationError:a,enableVoiceMode:!0},"voice"===d?"voice-chat-interaction":"chat-interaction"):n?(0,s.jsx)(t1.T,{conversationId:n,conversation:r||void 0,isOptimisticConversation:!1,conversationIsLoading:t,conversationError:a,enableVoiceMode:!0},"chat-interaction"):null}var t3=a(38362);let t5=()=>{let{t:e}=(0,j.Bd)("base"),t=(0,_.h)(),[a,i]=(0,y.useState)(""),n=(0,o.aP)(e=>e.lastMessageId),r=(0,o.aP)(e=>e.streamedMessageId),l=(0,O.A3)(e=>e.byId),d=l[n||""],c=l[r||""],[u,m]=(0,P.M)("notifications-toast-dismiss-count",0),[p,g]=(0,y.useState)(0),x=(0,y.useRef)(new Set),h=(0,z.C$)(e=>e.userSettings.preferences.browserNotificationsEnabled),v=(0,y.useCallback)(()=>{var a;(null==(a=document)||!a.hasFocus())&&(null==t?void 0:t.ENABLE_BROWSER_NOTIFICATIONS)&&(new Notification(e("notifications-answer-ready","Your answer from Grok is ready.")).onclick=()=>{window.focus()})},[null==t?void 0:t.ENABLE_BROWSER_NOTIFICATIONS,e]),f=(0,y.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];L.oR.dismiss(a),i(""),e&&m(e=>e+1)},[m,a]),b=!!(null==c?void 0:c.liveThinkingStartTime)||!!(null==c?void 0:c.thinkingStartTime)||!!(null==c?void 0:c.searchingStartTime)||(null==c?void 0:c.steps)&&c.steps.length>0;return(0,y.useEffect)(()=>{if(!h&&c&&b){if((null==c?void 0:c.state)==="streaming")return void g(1e3);(null==d?void 0:d.state)==="closed"&&g(0)}},[c,d,h,b]),(0,y.useEffect)(()=>{if(0===p||h)return;let e=setTimeout(()=>g(e=>e+1e3),1e3);return()=>clearTimeout(e)},[h,p]),(0,y.useEffect)(()=>{let e=p>=3e3&&p<=4e3;!a&&!h&&e&&u<1&&(null==t?void 0:t.ENABLE_BROWSER_NOTIFICATIONS)&&i((0,L.oR)((0,s.jsx)(t4,{onDismiss:f}),{duration:1/0,className:"inset-x-0 mx-auto"}))},[u,f,null==t?void 0:t.ENABLE_BROWSER_NOTIFICATIONS,p,a]),(0,y.useEffect)(()=>{(null==d?void 0:d.liveThinkingStartTime)&&(null==d?void 0:d.state)==="closed"&&(h&&n&&!x.current.has(n)&&(v(),x.current.add(n)),a&&(d.partial?f(!1):setTimeout(()=>f(!1),2e3)))},[h,f,d,v,a,n]),v},t4=e=>{let{onDismiss:t}=e,{t:a}=(0,j.Bd)("base"),[i,n]=(0,y.useState)("ASK"),r=(0,z.C$)(U.A("fetchSetPreference")),l=async()=>{if("granted"===Notification.permission||(n("WAIT"),"granted"===await Notification.requestPermission())){n("ALLOWED"),await r("browserNotificationsEnabled",!0);return}n("DENIED")};return((0,y.useEffect)(()=>{if("ASK"===i||"WAIT"===i)return;let e=setTimeout(t,2e3);return()=>clearTimeout(e)},[t,i]),(0,x.f)())?null:"DENIED"===i?(0,s.jsxs)("div",{className:"flex items-center gap-4 min-w-[360px]",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-sm font-semibold",children:a("notifications_declined_title","Notifications declined")}),(0,s.jsx)("div",{className:"text-xs text-secondary",children:a("notifications_change_anytime","You can change this anytime in settings.")})]}),(0,s.jsx)(m.X,{className:"size-5"})]}):"ALLOWED"===i?(0,s.jsxs)("div",{className:"flex items-center gap-4 min-w-[348px]",children:[(0,s.jsx)(m.Jlk,{className:"size-5"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-sm font-semibold",children:a("notifications_enabled_title","Notifications enabled")}),(0,s.jsx)("div",{className:"text-xs text-secondary",children:a("notifications_enabled_subtitle","We'll keep you updated")})]})]}):(0,s.jsxs)("div",{className:"flex justify-between items-center gap-4 relative group min-w-[360px]",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsx)(m.ZVq,{className:"size-5"}),(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"text-sm font-semibold",children:a("notifications_ask_title","Get notified when Grok finishes answering")}),(0,s.jsx)("div",{className:"text-xs text-secondary",children:a("notifications_ask_subtitle","Enable notifications")})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2 -me-2",children:[(0,s.jsx)(p.$n,{className:"rounded-xl px-2 py-2",variant:"secondary",disabled:"WAIT"===i,onClick:l,children:a("notifications_enable","Enable")}),(0,s.jsx)(p.$n,{variant:"textSecondary",size:"iconXs","aria-label":a("notifications-toast-dismiss","Dismiss"),onClick:()=>t(!0),children:(0,s.jsx)(m.X,{className:"!size-4"})})]})]})};function t6(e){let{conversationId:t,lastMessageId:a}=e,{t:i}=(0,j.Bd)("chat"),n=(0,o.aP)(U.A("requestShareDialogOpen")),r=(0,o.aP)(U.A("setRequestShareDialogOpen")),l=(0,H.Di)(),d=(0,A._)(),c=(0,y.useCallback)(e=>{r(e)},[r]);(0,y.useEffect)(()=>{n&&d("request_share_dialog_opened",void 0,{location:"request-share-dialog"})},[d,n]);let p=(0,y.useCallback)(()=>{r(!1)},[r]),g=(0,y.useCallback)(()=>{d("request_share_dialog_share_pressed",void 0,{location:"request-share-dialog"}),L.oR.success(i("share-request-dialog.share-success","Conversation shared!")),r(!1)},[r,d,i]),x=(0,y.useCallback)(()=>(0,s.jsxs)("div",{className:"space-y-4 py-2",children:[(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"flex items-start gap-2",children:[(0,s.jsx)("div",{className:"h-1.5 w-1.5 rounded-full mt-2 flex-shrink-0 bg-primary"}),(0,s.jsx)("p",{className:"text-sm",children:i("share-request-dialog.viewers-can-only-see-current-messages","Viewers will be only able to see current messages at time of sharing.")})]}),(0,s.jsxs)("div",{className:"flex items-start gap-2",children:[(0,s.jsx)("div",{className:"h-1.5 w-1.5 rounded-full mt-2 flex-shrink-0 bg-primary"}),(0,s.jsx)("p",{className:"text-sm",children:i("share-request-dialog.viewers-cannot-add-or-modify","Viewers will not be able to add or modify this conversation.")})]})]}),(0,s.jsxs)("div",{className:"flex items-start gap-2 p-3 border rounded-md",children:[(0,s.jsx)(m.hcu,{className:"h-4 w-4 text-secondary mt-0.5 flex-shrink-0"}),(0,s.jsxs)("div",{children:[(0,s.jsxs)("p",{className:"text-sm text-secondary font-semibold",children:[i("share-request-dialog.note","Note"),":"]}),(0,s.jsx)("p",{className:"text-sm italic text-secondary",children:i("share-request-dialog.sharing-this-conversation-means-anybody-with-the-share-link-will-be-able-to-view-it","Sharing this conversation means anybody with the share link will be able to view it.")})]})]}),(0,s.jsxs)("div",{className:"w-full flex items-center gap-2 justify-end",children:[(0,s.jsx)(e2.$n,{variant:"secondary",size:"md",shape:"rectangle",onClick:p,children:i("share-request-dialog.cancel","Cancel")}),t&&a&&(0,s.jsx)(u.w,{variant:"primary",size:"md",conversationId:t,responseId:a,iconProps:{size:18,strokeWidth:2},showLabel:!0,className:"rounded-xl",onClick:g})]})]}),[t,p,g,a,i]);return l?(0,s.jsx)(W._s,{open:n,onOpenChange:c,children:(0,s.jsxs)(W.zj,{className:"focus:outline-none bg-surface-l1 pt-1 p-6 h-[80dvh] mb-2",children:[(0,s.jsx)("div",{className:"text-lg font-semibold",children:i("share-request-dialog.title","Share request")}),(0,s.jsx)("div",{className:"text-sm text-muted-foreground mb-4",children:i("share-request-dialog.description","Someone would like access to a shared version of this conversation.")}),x()]})}):(0,s.jsx)(ee.lG,{open:n,onOpenChange:c,children:(0,s.jsxs)(ee.Cf,{className:"sm:max-w-md rounded-3xl border border-border-l1 p-6",children:[(0,s.jsxs)(ee.c7,{children:[(0,s.jsx)(ee.L3,{className:"text-lg font-semibold",children:i("share-request-dialog.title","Share request")}),(0,s.jsx)(ee.rr,{className:"text-sm text-muted-foreground",children:i("share-request-dialog.description","Someone would like access to a shared version of this conversation.")})]}),x()]})})}function t8(){let e=(0,_.h)(),t=(0,Q.K)(),{signInWithReturnTo:a}=(0,el.o)(),{user:l}=(0,ei.useSession)(),{handleVoiceModeEnter:d}=(0,eN.F)({location:"voice-chat-page"}),c=(0,o.aP)(U.A("optimisticConversationId")),u=(0,o.aP)(U.A("conversationId")),m=(0,o.aP)(U.A("lastMessageId")),p=(0,en.w1)(U.A("fetchGetConversation")),g=(0,o.aP)(U.A("conversationMode")),x=(0,o.aP)(U.A("voiceConnectionStatus")),h=(0,o.aP)(U.A("exitVoiceMode")),f=(0,z.C$)(e=>e.userSettings.preferences.showActiveTabs),b=(0,D.j)(U.A("isOpen")),w=(0,e_.useSearchParams)(),I=(0,e_.useRouter)(),N=(0,e_.usePathname)(),{route:S,replace:C}=(0,eE.wK)();(0,y.useEffect)(()=>{var e;if("chat"===S.page&&S.temporary)return;let t="chat"===S.page&&null!=(e=S.conversationId)?e:void 0;o.aP.setState({conversationId:t})},[S]);let E=(0,o.aP)(U.A("setRequestShareDialogOpen"));(0,y.useEffect)(()=>{let e="SHARE_REQUESTED";if("true"===w.get(e)){E(!0);let t=new URLSearchParams(w.toString());t.delete(e),I.replace("".concat(N,"?").concat(t.toString()),{scroll:!1})}},[N,I,w,E]),t5(),function(){let e=(0,e_.useSearchParams)(),{t}=(0,j.Bd)("chat"),a=(0,e_.useRouter)(),s=(0,y.useRef)(!1),i=e.get(ek.il),n=(0,eC.M4)(i||"");(0,y.useEffect)(()=>{if(!s.current&&i){setTimeout(()=>L.oR.success(t("oauth.connection.success","Successfully connected {{provider}}!",{provider:n})),0),s.current=!0;let e=new URL(window.location.href);e.searchParams.delete(ek.il),a.replace("".concat(e.pathname).concat(e.search).concat(e.hash,"/"),{scroll:!1})}},[n,i,a,t])}(),function(e){let t=(0,en.w1)(t=>e?t.byId[e]:void 0);(0,eS.r)(null==t?void 0:t.title)}(u);let{data:M,isLoading:P,error:A}=(0,ex.v)(u?p(u):void 0);(0,y.useEffect)(()=>{o.aP.getState().setChatPageLoaded(!0)},[]),(0,y.useEffect)(()=>{b&&"voice"===g&&h("navigation").catch(e=>{t("chat-page:exitVoiceMode",e)})},[b,g,h,t]),(0,y.useEffect)(()=>{if("voice"in S&&S.voice&&"voice"!==g&&(C({page:"main",voice:!1}),e.ENABLE_VOICE_MODE))if(l)d().catch(e=>(0,v.vV)("chat-page:handleVoiceModeEnter",e));else{(0,v.iu)("sign_in","voice-chat-page",{location:"voice-chat-page"}),a(void 0,void 0,!0);return}},[S,C,g,d,x,l,a,e]);let T=(0,y.useRef)(null);return(0,s.jsx)(r.t,{fallbackRender:()=>(0,s.jsx)(t9,{}),children:(0,s.jsxs)("main",{ref:T,className:(0,k.cn)("h-dvh flex-grow flex-shrink relative selection:bg-highlight w-0","@container isolate","print:h-full print:prose print:max-w-none"),children:[u&&m&&(0,s.jsx)(t6,{conversationId:u,lastMessageId:m}),(0,s.jsx)(n.a,{hidden:!0}),(0,s.jsx)(t3.g,{conversationId:u,containerRef:T,user:l}),(0,s.jsx)(eV.hx,{showTasks:!0,conversationIsLoading:P,conversation:M||void 0,isOptimisticConversation:!!c}),(0,s.jsx)(i.CommandMenu,{}),c&&"main"===S.page||u&&"chat"===S.page?(0,s.jsx)(t2,{optimisticConversationId:c,conversationIsLoading:P,conversationError:A,conversationId:u,conversation:M},"conversation-view"):(0,s.jsx)(tZ,{}),(0,s.jsx)(es,{}),e.ENABLE_CONVERSATION_TABS&&!e.USE_APP_SIDEBAR_V2&&f&&(0,s.jsx)(ew,{})]},"chat-page")})}function t9(){let{t:e}=(0,j.Bd)("chat");return(0,s.jsx)("div",{className:"w-full h-dvh flex justify-center items-center align-middle",children:(0,s.jsxs)("div",{className:"w-full max-w-lg text-center",children:[(0,s.jsx)(eE.N_,{route:{page:"main"},className:"mb-6 flex justify-center",children:(0,s.jsx)(l.r1,{height:20,width:60,className:"opacity-80 hover:opacity-100 fill-black dark:fill-white"})}),(0,s.jsx)("div",{children:e("There was an error","There was an error")}),(0,s.jsx)("div",{className:"mt-6",children:(0,s.jsx)(p.$n,{variant:"primary",size:"md",onClick:()=>{window.location.href="/"},children:e("Return to Home","Return to Home")})})]})})}},68217:(e,t,a)=>{a.d(t,{K:()=>g});var s=a(625),i=a(42557),n=a(24734),r=a(17703),l=a(95158),o=a(56907),d=a(20014),c=a(88382),u=a(98579),m=a(4878),p=a(39489);function g(e){let{pageSize:t=60,orderBy:a="createTime"}=e,g=(0,i.wV)(),x=(0,u.o)(),h=g.user,v=(0,n.K)(),{currentTeam:f,isSwitchingTeam:b}=(0,s.hd)(),{ASSET_SERVER_URL:y}=(0,p.v)(),{data:j,isLoading:w}=(0,o.IT)({queryKey:["team-members",null==f?void 0:f.teamId],enabled:!!(null==f?void 0:f.teamId),queryFn:async()=>l.wM.authManagementListUsers({teamId:f.teamId}).then(e=>{var t;return(null==(t=e.members)?void 0:t.filter(e=>{var t;return(null==(t=e.user)?void 0:t.userId)!==(null==h?void 0:h.userId)}))||[]}).catch(e=>((0,r.vV)("share-dialog:fetch-team-members",e),[]))}),I=(0,c.useMemo)(()=>{let e=new Map;return null==j||j.forEach(t=>{var a,s,i,n,r,l;e.set((null==(a=t.user)?void 0:a.userId)||"",{userId:(null==(s=t.user)?void 0:s.userId)||"",xUserId:(null==(i=t.user)?void 0:i.xUserId)||"",givenName:(null==(n=t.user)?void 0:n.givenName)||"",familyName:(null==(r=t.user)?void 0:r.familyName)||"",profileImageUrl:(0,m.sU)(y,null==(l=t.user)?void 0:l.profileImage)})}),e},[j,y]),N=(0,c.useRef)(null),k=(0,c.useRef)(null),[S,C]=(0,c.useState)(!1),[E,_]=(0,c.useState)(!1),M=(0,c.useCallback)(async e=>{let{pageParam:s}=e;if(!h)return{shareLinkResults:[],nextPageToken:void 0};try{let{shareLinks:e,nextPageToken:i}=await l.chatApi.chatListShareLinks({sharedWithMe:!0,pageToken:"string"==typeof s?s:void 0,pageSize:t.toString(),orderBy:"createTime"===a?"LIST_SHARE_LINKS_ORDER_BY_CREATE_TIME":"viewCount"===a?"LIST_SHARE_LINKS_ORDER_BY_VIEW_COUNT":"LIST_SHARE_LINKS_ORDER_BY_INVALID"});return{shareLinkResults:(null==e?void 0:e.map(e=>{var t;let{sharedLink:a,...s}=e;return{...s,conversation:(null==a?void 0:a.conversation)||null,response:(null==a||null==(t=a.responses)?void 0:t.find(t=>t.responseId===e.responseId))||null}}))||[],nextPageToken:i}}catch(e){throw v("use-search-conversations",e),e}},[h,v,t,a]),{data:P,fetchNextPage:A,hasNextPage:T,isFetchingNextPage:R,isFetching:D,isError:O,isLoading:z,refetch:U}=(0,o.qu)({queryKey:["share-links",null==h?void 0:h.userId,t,a],queryFn:M,initialPageParam:void 0,getNextPageParam:e=>e.nextPageToken,enabled:!!h&&!!(null==f?void 0:f.teamId)&&!b,staleTime:6e5,refetchOnWindowFocus:!0}),L=(0,c.useMemo)(()=>{var e;let t=(null==P||null==(e=P.pages.flatMap(e=>e.shareLinkResults))?void 0:e.filter(e=>!!e.shareLinkId))||[],s="createTime"===a?t.sort((e,t)=>new Date((null==t?void 0:t.createTime)||Date.now()).getTime()-new Date((null==e?void 0:e.createTime)||Date.now()).getTime()):t.sort((e,t)=>parseInt(t.viewCount||"0")-parseInt(e.viewCount||"0"));return d.A(e=>null==e?void 0:e.shareLinkId,s).map(e=>({...e,user:(null==e?void 0:e.xaiUserId)?I.get(e.xaiUserId):void 0}))},[null==P?void 0:P.pages,I,a]),B=(0,c.useCallback)(e=>{let t=L.find(t=>t.shareLinkId===e);return(null==t?void 0:t.publicId)?x(t.publicId):x(e)},[L,x]),K=(0,c.useCallback)(e=>{window.location.href=B(e)},[B]);return(0,c.useEffect)(()=>{if(!(null==N?void 0:N.current)||!(null==k?void 0:k.current))return;let e=new IntersectionObserver(e=>{let[t]=e;t&&C(t.isIntersecting)},{root:k.current,rootMargin:"300px 0px 300px 0px",threshold:.1}),t=N.current;if(t)return e.observe(t),()=>{e.unobserve(t)}},[null==N?void 0:N.current,null==k?void 0:k.current]),(0,c.useLayoutEffect)(()=>{S&&T&&!R&&h&&!E&&(_(!0),A().catch(e=>(0,r.vV)("intersection-load-more",e)))},[S,T,R,A,h,E]),(0,c.useEffect)(()=>{if(E){let e=setTimeout(()=>{_(!1)},300);return()=>clearTimeout(e)}},[E]),{results:L,refetch:U,loadMoreRef:N,containerRef:k,isLoading:z,isFetching:D,isError:O,isLoadingTeamMembers:w,getShareLinkHref:B,handleNavigateToSharedConversation:K}}},76393:(e,t,a)=>{a.d(t,{p:()=>n});var s=a(79342),i=a(61312);let n=e=>{let{value:t,formatter:a,prefix:n,suffix:r,className:l}=e,o=t>0?"+":t<0?"-":"",d=Math.abs(t),c=a?a(d):d;return(0,s.jsxs)("span",{className:(0,i.cn)(t>0?"text-teal-300":t<0?"text-red-300":"text-muted-foreground",l),children:[n,!!o&&o,c,r]})}},93220:(e,t,a)=>{a.d(t,{$:()=>l});var s=a(79342),i=a(61312),n=a(11750),r=a(23054);let l=e=>{let{className:t}=e;return(0,s.jsx)(r.P.div,{initial:{opacity:0,filter:"blur(4px)"},animate:{opacity:1,filter:"blur(0px)"},transition:{ease:"easeInOut"},className:(0,i.cn)("h-full w-full flex items-center justify-center animate-pulse-lg",t),children:(0,s.jsx)(n.xfq,{size:60,strokeWidth:1.3,className:"opacity-30 rotate-[-10deg]"})},"loader")}}}]);